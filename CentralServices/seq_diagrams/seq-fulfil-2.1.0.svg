<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2242px" preserveAspectRatio="none" style="width:2574px;height:2242px;" version="1.1" viewBox="0 0 2574 2242" width="2574px" zoomAndPan="magnify"><defs><filter height="300%" id="f167q8wn88pu9c" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="374" x="1101" y="23.5352">2.1.0. DFSP2 sends a Fulfil Success Transfer request</text><rect fill="#D3D3D3" height="2197.2813" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2197.2813" style="stroke: #A80036; stroke-width: 1.0;" width="564.5" x="397.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="601.25" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2197.2813" style="stroke: #A80036; stroke-width: 1.0;" width="1583" x="964" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1705" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451.5" y="719.7129"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="836.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1158" y="1167.4766"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1516" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1970.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2299.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1941.0176" style="stroke: #000000; stroke-width: 2.0;" width="2540" x="23" y="170.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2520" x="33" y="1746.377"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2461" x="92" y="1947.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="456.5" x2="456.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="841" x2="841" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1035" x2="1035" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1163" x2="1163" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1520.5" x2="1520.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1685.5" x2="1685.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1832.5" x2="1832.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1975.5" x2="1975.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2135.5" x2="2135.5" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2304" x2="2304" y1="153.7754" y2="2128.793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2469" x2="2469" y1="153.7754" y2="2128.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2141.3281">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2157.8164">Payer</text><ellipse cx="67.5" cy="2170.7695" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2178.7695 L67.5,2205.7695 M54.5,2186.7695 L80.5,2186.7695 M67.5,2205.7695 L54.5,2220.7695 M67.5,2205.7695 L80.5,2220.7695 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2141.3281">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2157.8164">Payee</text><ellipse cx="126.5" cy="2170.7695" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2178.7695 L126.5,2205.7695 M113.5,2186.7695 L139.5,2186.7695 M126.5,2205.7695 L113.5,2220.7695 M126.5,2205.7695 L139.5,2220.7695 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="401.5" y="150.8223">ML API Adapter</text><path d="M436,109.2871 L436,133.2871 M436,121.2871 L453,121.2871 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="465" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="401.5" y="2141.3281">ML API Adapter</text><path d="M436,2148.2813 L436,2172.2813 M436,2160.2813 L453,2160.2813 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="465" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="725" y="150.8223">ML API Notification Event Handler</text><ellipse cx="841.5" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="837.5,109.2871,843.5,104.2871,841.5,109.2871,843.5,114.2871,837.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="725" y="2141.3281">ML API Notification Event Handler</text><ellipse cx="841.5" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="837.5,2148.2813,843.5,2143.2813,841.5,2148.2813,843.5,2153.2813,837.5,2148.2813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="968" y="150.8223">Central Service API</text><path d="M1014.5,109.2871 L1014.5,133.2871 M1014.5,121.2871 L1031.5,121.2871 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1043.5" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="968" y="2141.3281">Central Service API</text><path d="M1014.5,2148.2813 L1014.5,2172.2813 M1014.5,2160.2813 L1031.5,2160.2813 " fill="none" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1043.5" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1116" y="114.2871"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1112" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1119" y="138.8223">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1116" y="2127.793"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1112" y="2131.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1119" y="2152.3281">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1451.5" y="150.8223">Fulfil Event Handler</text><ellipse cx="1521" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1517,109.2871,1523,104.2871,1521,109.2871,1523,114.2871,1517,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1451.5" y="2141.3281">Fulfil Event Handler</text><ellipse cx="1521" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1517,2148.2813,1523,2143.2813,1521,2148.2813,1523,2153.2813,1517,2148.2813" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1604.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1600.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1607.5" y="138.8223">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1604.5" y="2127.793"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1600.5" y="2131.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1607.5" y="2152.3281">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1784.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1780.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1787.5" y="138.8223">Event-Topic</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1784.5" y="2127.793"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1780.5" y="2131.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1787.5" y="2152.3281">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1895.5" y="150.8223">Position Event Handler</text><ellipse cx="1975.5" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1971.5,109.2871,1977.5,104.2871,1975.5,109.2871,1977.5,114.2871,1971.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1895.5" y="2141.3281">Position Event Handler</text><ellipse cx="1975.5" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1971.5,2148.2813,1977.5,2143.2813,1975.5,2148.2813,1977.5,2153.2813,1971.5,2148.2813" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2076.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2072.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2079.5" y="138.8223">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2076.5" y="2127.793"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2072.5" y="2131.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2079.5" y="2152.3281">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2223" y="150.8223">Transfer Event Handler</text><ellipse cx="2304.5" cy="121.2871" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2300.5,109.2871,2306.5,104.2871,2304.5,109.2871,2306.5,114.2871,2300.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2223" y="2141.3281">Transfer Event Handler</text><ellipse cx="2304.5" cy="2160.2813" fill="#FEFECE" filter="url(#f167q8wn88pu9c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2300.5,2148.2813,2306.5,2143.2813,2304.5,2148.2813,2306.5,2153.2813,2300.5,2148.2813" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2400" y="114.2871"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2396" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2403" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2400" y="2127.793"/><rect fill="#FEFECE" filter="url(#f167q8wn88pu9c)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2396" y="2131.793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2403" y="2152.3281">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451.5" y="719.7129"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="836.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1158" y="1167.4766"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1516" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1970.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="1955.0176" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2299.5" y="163.7754"/><path d="M23,170.7754 L376,170.7754 L376,177.7754 L366,187.7754 L23,187.7754 L23,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1941.0176" style="stroke: #000000; stroke-width: 2.0;" width="2540" x="23" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308" x="38" y="184.3438">DFSP2 sends a Fulfil Success Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="168.5" y1="240.0176" y2="240.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168.5" x2="168.5" y1="240.0176" y2="253.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127.5" x2="168.5" y1="253.0176" y2="253.0176"/><polygon fill="#A80036" points="137.5,249.0176,127.5,253.0176,137.5,257.0176,133.5,253.0176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="219.9648">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="204.6543">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="146.5" y="219.9648">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="146.5" y="235.2754">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="230.5" y="235.2754">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="257.5" y="235.2754">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="329.5" y="235.2754">as inputs</text><path d="M131,266.0176 L131,689.0176 L472,689.0176 L472,276.0176 L462,266.0176 L131,266.0176 " fill="#FFFF00" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M462,266.0176 L462,276.0176 L472,276.0176 L462,266.0176 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="137" y="283.5859">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="153" y="298.8965">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="153" y="314.207">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="153" y="329.5176">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="344.8281">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="153" y="360.1387">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="153" y="375.4492">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="153" y="390.7598">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="406.0703">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="153" y="421.3809">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="153" y="436.6914">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="452.002">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="467.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="137" y="482.623">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="497.9336">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="153" y="513.2441">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="153" y="528.5547">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="153" y="543.8652">"transferState": "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="153" y="559.1758">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="169" y="574.4863">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="185" y="589.7969">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="201" y="605.1074">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="201" y="620.418">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="185" y="635.7285">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="169" y="651.0391">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="153" y="666.3496">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="681.6602">}</text><polygon fill="#A80036" points="439.5,715.7129,449.5,719.7129,439.5,723.7129,443.5,719.7129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="445.5" y1="719.7129" y2="719.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="714.9707">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="146.5" y="714.9707">PUT - http://transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="461.5" x2="503.5" y1="749.0234" y2="749.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="503.5" y1="749.0234" y2="762.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="462.5" x2="503.5" y1="762.0234" y2="762.0234"/><polygon fill="#A80036" points="472.5,758.0234,462.5,762.0234,472.5,766.0234,468.5,762.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="468.5" y="744.2813">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="481.5" y="744.2813">Validate incoming token and originator matching Payee</text><path d="M466,775.0234 L466,1137.0234 L775,1137.0234 L775,785.0234 L765,775.0234 L466,775.0234 " fill="#FFFF00" filter="url(#f167q8wn88pu9c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M765,775.0234 L765,785.0234 L775,785.0234 L765,775.0234 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="472" y="792.5918">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="472" y="807.9023">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="823.2129">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="488" y="838.5234">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="488" y="853.834">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="488" y="869.1445">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="488" y="884.4551">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="504" y="899.7656">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="504" y="915.0762">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="488" y="930.3867">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="488" y="945.6973">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="504" y="961.0078">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="520" y="976.3184">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="520" y="991.6289">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="520" y="1006.9395">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="520" y="1022.25">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="520" y="1037.5605">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="536" y="1052.8711">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="536" y="1068.1816">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="1083.4922">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="1098.8027">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="1114.1133">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="472" y="1129.4238">}</text><polygon fill="#A80036" points="1146,1163.4766,1156,1167.4766,1146,1171.4766,1150,1167.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461.5" x2="1152" y1="1167.4766" y2="1167.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="468.5" y="1162.7344">4</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="481.5" y="1162.7344">Route &amp; Publish Fulfil event for Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1168" x2="1210" y1="1196.7871" y2="1196.7871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1210" x2="1210" y1="1196.7871" y2="1209.7871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1169" x2="1210" y1="1209.7871" y2="1209.7871"/><polygon fill="#A80036" points="1179,1205.7871,1169,1209.7871,1179,1213.7871,1175,1209.7871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1175" y="1192.0449">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="1188" y="1192.0449">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="472.5,1235.0977,462.5,1239.0977,472.5,1243.0977,468.5,1239.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="466.5" x2="1162" y1="1239.0977" y2="1239.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="1234.3555">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="491.5" y="1234.3555">Respond replication acknowledgements have been received</text><polygon fill="#A80036" points="137.5,1264.4082,127.5,1268.4082,137.5,1272.4082,133.5,1268.4082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="131.5" x2="455.5" y1="1268.4082" y2="1268.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="143.5" y="1263.666">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="156.5" y="1263.666">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1174,1293.7188,1164,1297.7188,1174,1301.7188,1170,1297.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1168" x2="1515" y1="1297.7188" y2="1297.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1180" y="1292.9766">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1193" y="1292.9766">Consume message</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="775.5" x="1109" y="1305.7188"/><polygon fill="#EEEEEE" points="1109,1305.7188,1173,1305.7188,1173,1312.7188,1163,1322.7188,1109,1322.7188,1109,1305.7188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1122" y="1320.2871">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1367.75" y="1339.2871">Fulfil Handler Consume (Success) {2.1.1.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1371.75" y="1354.5977"/><polygon fill="#A80036" points="1673.5,1383.9609,1683.5,1387.9609,1673.5,1391.9609,1677.5,1387.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1526" x2="1679.5" y1="1387.9609" y2="1387.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1533" y="1383.2188">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1546" y="1383.2188">Produce message</text><polygon fill="#A80036" points="1696.5,1438.2715,1686.5,1442.2715,1696.5,1446.2715,1692.5,1442.2715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1690.5" x2="1969.5" y1="1442.2715" y2="1442.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1702.5" y="1437.5293">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1724.5" y="1437.5293">Consume message</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="600" x="1597.5" y="1450.2715"/><polygon fill="#EEEEEE" points="1597.5,1450.2715,1661.5,1450.2715,1661.5,1457.2715,1651.5,1467.2715,1597.5,1467.2715,1597.5,1450.2715" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1610.5" y="1464.8398">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1759" y="1483.8398">Position Handler Consume (Success) {2.1.2.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1763" y="1499.1504"/><polygon fill="#A80036" points="2123.5,1528.5137,2133.5,1532.5137,2123.5,1536.5137,2127.5,1532.5137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1980.5" x2="2129.5" y1="1532.5137" y2="1532.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1987.5" y="1527.7715">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2009.5" y="1527.7715">Produce message</text><polygon fill="#A80036" points="2146.5,1582.8242,2136.5,1586.8242,2146.5,1590.8242,2142.5,1586.8242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2140.5" x2="2298.5" y1="1586.8242" y2="1586.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2152.5" y="1582.082">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2174.5" y="1582.082">Consume message</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="764.5" x="1777.5" y="1594.8242"/><polygon fill="#EEEEEE" points="1777.5,1594.8242,1841.5,1594.8242,1841.5,1601.8242,1831.5,1611.8242,1777.5,1611.8242,1777.5,1594.8242" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1790.5" y="1609.3926">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="2020.75" y="1628.3926">Transfer Handler Consume (Success) {2.1.3.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2024.75" y="1643.7031"/><polygon fill="#A80036" points="2457.5,1673.0664,2467.5,1677.0664,2457.5,1681.0664,2461.5,1677.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2309.5" x2="2463.5" y1="1677.0664" y2="1677.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2316.5" y="1672.3242">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2338.5" y="1672.3242">Produce message</text><polygon fill="#A80036" points="2457.5,1727.377,2467.5,1731.377,2457.5,1735.377,2461.5,1731.377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846.5" x2="2463.5" y1="1731.377" y2="1731.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="853.5" y="1726.6348">14</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="875.5" y="1726.6348">Consume message</text><path d="M33,1746.377 L100,1746.377 L100,1753.377 L90,1763.377 L33,1763.377 L33,1746.377 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2520" x="33" y="1746.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="1759.9453">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="115" y="1759.0117">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2502" x="40" y="1788.6875"/><polygon fill="#EEEEEE" points="40,1788.6875,104,1788.6875,104,1795.6875,94,1805.6875,40,1805.6875,40,1788.6875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="1803.2559">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1147" y="1822.2559">Send notification to Participant (Payer) {1.1.4.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1151" y="1837.5664"/><polygon fill="#A80036" points="78.5,1866.9297,68.5,1870.9297,78.5,1874.9297,74.5,1870.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="835.5" y1="1870.9297" y2="1870.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="1866.1875">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="106.5" y="1866.1875">Send callback notification</text><polygon fill="#A80036" points="2457.5,1928.2402,2467.5,1932.2402,2457.5,1936.2402,2461.5,1932.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846.5" x2="2463.5" y1="1932.2402" y2="1932.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="853.5" y="1927.498">16</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="875.5" y="1927.498">Consume message</text><path d="M92,1947.2402 L159,1947.2402 L159,1954.2402 L149,1964.2402 L92,1964.2402 L92,1947.2402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2461" x="92" y="1947.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="107" y="1960.8086">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="174" y="1959.875">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f167q8wn88pu9c)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2443" x="99" y="1989.5508"/><polygon fill="#EEEEEE" points="99,1989.5508,163,1989.5508,163,1996.5508,153,2006.5508,99,2006.5508,99,1989.5508" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2004.1191">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="1175.5" y="2023.1191">Send notification to Participant (Payee) {1.1.4.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1179.5" y="2038.4297"/><polygon fill="#A80036" points="137.5,2067.793,127.5,2071.793,137.5,2075.793,133.5,2071.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="835.5" y1="2071.793" y2="2071.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2067.0508">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="165.5" y="2067.0508">Send callback notification</text><!--
@startuml
title 2.1.0. DFSP2 sends a Fulfil Success Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Position-Topic-dfsp2" as TOPIC_POSITION_DFSP2
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
collections "Event-Topic" as TOPIC_EVENTS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_POSITION_DFSP2
    participant TOPIC_EVENTS
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
activate TRANS_HANDLER
group DFSP2 sends a Fulfil Success Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": "COMMITTED",
            "extensionList": {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    DFSP2 -> MLAPI: PUT - http://transfers/<ID>
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: <color #FF0000>**Route & Publish Fulfil event for Payee**</color>
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - -> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_EVENTS:  Fulfil Handler Consume (Success) {2.1.1.} \n
    FULF_HANDLER -> TOPIC_POSITION_DFSP2: Produce message
    |||
    TOPIC_POSITION_DFSP2 <- POS_HANDLER: Consume message
    ref over TOPIC_POSITION_DFSP2, TOPIC_TRANSFERS:  Position Handler Consume (Success) {2.1.2.} \n
    POS_HANDLER -> TOPIC_TRANSFERS: Produce message
    |||
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume message
    ref over TOPIC_EVENTS, TOPIC_NOTIFICATIONS: Transfer Handler Consume (Success) {2.1.3.} \n
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: <color #FF0000>**Consume message**</color>
    opt action == 'commit'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer) {1.1.4.} \n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: <color #FF0000>**Consume message**</color>
    opt action == 'commit'
        |||
        ref over DFSP2, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {1.1.4.} \n
        NOTIFY_HANDLER -> DFSP2: Send callback notification
    end
    |||
end
deactivate TRANS_HANDLER
deactivate POS_HANDLER
deactivate FULF_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>