<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1307px" preserveAspectRatio="none" style="width:1305px;height:1307px;" version="1.1" viewBox="0 0 1305 1307" width="1305px" zoomAndPan="magnify"><defs><filter height="300%" id="f9ng2o4sla8u0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="453.5" y="23.5352">1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="1262.375" style="stroke: #A80036; stroke-width: 1.0;" width="122" x="16" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="47" y="47.0566">Financial</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="19" y="62.3672">Service Providers</text><rect fill="#ADD8E6" height="1262.375" style="stroke: #A80036; stroke-width: 1.0;" width="296" x="164.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="234" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1262.375" style="stroke: #A80036; stroke-width: 1.0;" width="825.5" x="462.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="824.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="279.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="218.5" y="285.9492"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="384.5" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="403.502"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="706" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="903" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1127.5" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="990.8008" style="stroke: #000000; stroke-width: 2.0;" width="1281" x="13" y="186.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="47" x2="47" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="106" x2="106" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="223.5" x2="223.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="389.5" x2="389.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="506.5" x2="506.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="593.5" x2="593.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="711" x2="711" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="806.5" x2="806.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="907.5" x2="907.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1022.5" x2="1022.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1132.5" x2="1132.5" y1="169.0859" y2="1193.8867"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1233" x2="1233" y1="169.0859" y2="1193.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="149.6445">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="26" y="166.1328">Payer</text><ellipse cx="47.5" cy="79.1094" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,87.1094 L47.5,114.1094 M34.5,95.1094 L60.5,95.1094 M47.5,114.1094 L34.5,129.1094 M47.5,114.1094 L60.5,129.1094 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="1206.4219">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="26" y="1222.9102">Payer</text><ellipse cx="47.5" cy="1235.8633" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,1243.8633 L47.5,1270.8633 M34.5,1251.8633 L60.5,1251.8633 M47.5,1270.8633 L34.5,1285.8633 M47.5,1270.8633 L60.5,1285.8633 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="149.6445">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="84" y="166.1328">Payee</text><ellipse cx="106.5" cy="79.1094" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,87.1094 L106.5,114.1094 M93.5,95.1094 L119.5,95.1094 M106.5,114.1094 L93.5,129.1094 M106.5,114.1094 L119.5,129.1094 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="1206.4219">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="84" y="1222.9102">Payee</text><ellipse cx="106.5" cy="1235.8633" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,1243.8633 L106.5,1270.8633 M93.5,1251.8633 L119.5,1251.8633 M106.5,1270.8633 L93.5,1285.8633 M106.5,1270.8633 L119.5,1285.8633 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="168.5" y="166.1328">ML API Adapter</text><path d="M203,124.5977 L203,148.5977 M203,136.5977 L220,136.5977 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="232" cy="136.5977" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="168.5" y="1206.4219">ML API Adapter</text><path d="M203,1213.375 L203,1237.375 M203,1225.375 L220,1225.375 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="232" cy="1225.375" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="322.5" y="149.6445">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="339" y="166.1328">Event Handler</text><ellipse cx="389.5" cy="120.1094" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="385.5,108.1094,391.5,103.1094,389.5,108.1094,391.5,113.1094,385.5,108.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="322.5" y="1206.4219">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="339" y="1222.9102">Event Handler</text><ellipse cx="389.5" cy="1241.8633" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="385.5,1229.8633,391.5,1224.8633,389.5,1229.8633,391.5,1234.8633,385.5,1229.8633" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="478.5" y="149.6445">Central</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="466.5" y="166.1328">Service API</text><path d="M486,108.1094 L486,132.1094 M486,120.1094 L503,120.1094 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="515" cy="120.1094" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="478.5" y="1206.4219">Central</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="466.5" y="1222.9102">Service API</text><path d="M486,1229.8633 L486,1253.8633 M486,1241.8633 L503,1241.8633 " fill="none" filter="url(#f9ng2o4sla8u0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="515" cy="1241.8633" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="560.5" y="96.6211"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="556.5" y="100.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="563.5" y="121.1563">Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="571" y="137.6445">Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="570.5" y="154.1328">dfsp1</text><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="560.5" y="1192.8867"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="556.5" y="1196.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="563.5" y="1217.4219">Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="571" y="1233.9102">Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="570.5" y="1250.3984">dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="681.5" y="133.1563">Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="689.5" y="149.6445">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="681" y="166.1328">Handler</text><ellipse cx="711" cy="103.6211" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="707,91.6211,713,86.6211,711,91.6211,713,96.6211,707,91.6211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="681.5" y="1206.4219">Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="689.5" y="1222.9102">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="681" y="1239.3984">Handler</text><ellipse cx="711" cy="1258.3516" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="707,1246.3516,713,1241.3516,711,1246.3516,713,1251.3516,707,1246.3516" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="772.5" y="96.6211"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="768.5" y="100.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="775.5" y="121.1563">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="784" y="137.6445">Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="783.5" y="154.1328">dfsp1</text><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="772.5" y="1192.8867"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="768.5" y="1196.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="775.5" y="1217.4219">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="784" y="1233.9102">Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="783.5" y="1250.3984">dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="877.5" y="133.1563">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="886.5" y="149.6445">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="878" y="166.1328">Handler</text><ellipse cx="908" cy="103.6211" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="904,91.6211,910,86.6211,908,91.6211,910,96.6211,904,91.6211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="877.5" y="1206.4219">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="886.5" y="1222.9102">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="878" y="1239.3984">Handler</text><ellipse cx="908" cy="1258.3516" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="904,1246.3516,910,1241.3516,908,1246.3516,910,1251.3516,904,1246.3516" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="986.5" y="113.1094"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="982.5" y="117.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="989.5" y="137.6445">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="999.5" y="154.1328">Topic</text><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="986.5" y="1192.8867"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="982.5" y="1196.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="989.5" y="1217.4219">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="999.5" y="1233.9102">Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1100.5" y="133.1563">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1111" y="149.6445">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1102.5" y="166.1328">Handler</text><ellipse cx="1132.5" cy="103.6211" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1128.5,91.6211,1134.5,86.6211,1132.5,91.6211,1134.5,96.6211,1128.5,91.6211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1100.5" y="1206.4219">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1111" y="1222.9102">Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1102.5" y="1239.3984">Handler</text><ellipse cx="1132.5" cy="1258.3516" fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1128.5,1246.3516,1134.5,1241.3516,1132.5,1246.3516,1134.5,1251.3516,1128.5,1246.3516" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1187" y="113.1094"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1183" y="117.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1190" y="137.6445">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="1210.5" y="154.1328">Topic</text><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1187" y="1192.8867"/><rect fill="#FEFECE" filter="url(#f9ng2o4sla8u0)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1183" y="1196.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1190" y="1217.4219">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="1210.5" y="1233.9102">Topic</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="279.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="218.5" y="285.9492"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="384.5" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="403.502"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="706" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="903" y="179.0859"/><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="1004.8008" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1127.5" y="179.0859"/><path d="M13,186.0859 L392,186.0859 L392,193.0859 L382,203.0859 L13,203.0859 L13,186.0859 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="990.8008" style="stroke: #000000; stroke-width: 2.0;" width="1281" x="13" y="186.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="334" x="28" y="199.6543">DFSP1 sends a Prepare Transfer request to DFSP2</text><polygon fill="#A80036" points="206.5,281.9492,216.5,285.9492,206.5,289.9492,210.5,285.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="212.5" y1="285.9492" y2="285.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="54.5" y="250.5859">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="67.5" y="219.9648">POST - /transfers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="67.5" y="235.2754">(transferId, payerFsp,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="67.5" y="250.5859">payeeFsp, amount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="67.5" y="265.8965">currency, ilpPacket,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="67.5" y="281.207">condition, expiration)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="228.5" x2="270.5" y1="345.8809" y2="345.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="270.5" x2="270.5" y1="345.8809" y2="358.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="229.5" x2="270.5" y1="358.8809" y2="358.8809"/><polygon fill="#A80036" points="239.5,354.8809,229.5,358.8809,239.5,362.8809,235.5,358.8809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="235.5" y="325.8281">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="248.5" y="310.5176">Validate incoming</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="248.5" y="325.8281">token and originator</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="248.5" y="341.1387">matching Payer</text><polygon fill="#A80036" points="577,399.502,587,403.502,577,407.502,581,403.502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228.5" x2="583" y1="403.502" y2="403.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="235.5" y="391.1045">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="248.5" y="383.4492">Produce prepare event for Payer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="248.5" y="398.7598">(type: 'prepare', action: 'prepare')</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="641" y1="478.7441" y2="478.7441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641" x2="641" y1="478.7441" y2="491.7441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="600" x2="641" y1="491.7441" y2="491.7441"/><polygon fill="#A80036" points="610,487.7441,600,491.7441,610,495.7441,606,491.7441" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="606" y="451.0361">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="619" y="428.0703">Event is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="619" y="443.3809">replicated as</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="619" y="458.6914">configured</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="619" y="474.002">(ACKS=all)</text><polygon fill="#A80036" points="239.5,517.0547,229.5,521.0547,239.5,525.0547,235.5,521.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="233.5" x2="593" y1="521.0547" y2="521.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="245.5" y="516.3125">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="258.5" y="516.3125">Replication acknowledgements</text><polygon fill="#A80036" points="58.5,561.6758,48.5,565.6758,58.5,569.6758,54.5,565.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="222.5" y1="565.6758" y2="565.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="64.5" y="553.2783">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="77.5" y="545.623">Respond HTTP -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="77.5" y="560.9336">202 (Accepted)</text><polygon fill="#A80036" points="605,615.9863,595,619.9863,605,623.9863,601,619.9863" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="705" y1="619.9863" y2="619.9863"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="611" y="615.2441">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="624" y="615.2441">Consume</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="291" x="553.5" y="627.9863"/><polygon fill="#EEEEEE" points="553.5,627.9863,617.5,627.9863,617.5,634.9863,607.5,644.9863,553.5,644.9863,553.5,627.9863" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="566.5" y="642.5547">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="564.5" y="661.5547">Prepare Handler Consume {1.1.1.a, 1.1.1.b}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="568.5" y="676.8652"/><polygon fill="#A80036" points="795,706.2285,805,710.2285,795,714.2285,799,710.2285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="716" x2="801" y1="710.2285" y2="710.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="723" y="705.4863">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="736" y="705.4863">Produce</text><polygon fill="#A80036" points="818,760.5391,808,764.5391,818,768.5391,814,764.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="812" x2="902" y1="764.5391" y2="764.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="824" y="759.7969">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="837" y="759.7969">Consume</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="296" x="765.5" y="772.5391"/><polygon fill="#EEEEEE" points="765.5,772.5391,829.5,772.5391,829.5,779.5391,819.5,789.5391,765.5,789.5391,765.5,772.5391" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="778.5" y="787.1074">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="776.5" y="806.1074">Position Handler Consume {1.1.2.a, 1.1.2.b}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="780.5" y="821.418"/><polygon fill="#A80036" points="1010.5,850.7813,1020.5,854.7813,1010.5,858.7813,1014.5,854.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="913" x2="1016.5" y1="854.7813" y2="854.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="920" y="850.0391">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="942" y="850.0391">Produce</text><polygon fill="#A80036" points="1033.5,905.0918,1023.5,909.0918,1033.5,913.0918,1029.5,909.0918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1027.5" x2="1126.5" y1="909.0918" y2="909.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1039.5" y="904.3496">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="1061.5" y="904.3496">Consume</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="303.5" x="979.5" y="917.0918"/><polygon fill="#EEEEEE" points="979.5,917.0918,1043.5,917.0918,1043.5,924.0918,1033.5,934.0918,979.5,934.0918,979.5,917.0918" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="992.5" y="931.6602">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="993.75" y="950.6602">Transfer Handler Consume {1.1.3.a, 1.2.3.b}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="997.75" y="965.9707"/><polygon fill="#A80036" points="1221.5,995.334,1231.5,999.334,1221.5,1003.334,1225.5,999.334" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1137.5" x2="1227.5" y1="999.334" y2="999.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1144.5" y="994.5918">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1166.5" y="994.5918">Produce</text><polygon fill="#A80036" points="1221.5,1049.6445,1231.5,1053.6445,1221.5,1057.6445,1225.5,1053.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="1227.5" y1="1053.6445" y2="1053.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="401.5" y="1048.9023">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="423.5" y="1048.9023">Consume</text><rect fill="#FFFFFF" filter="url(#f9ng2o4sla8u0)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1204" x="79" y="1061.6445"/><polygon fill="#EEEEEE" points="79,1061.6445,143,1061.6445,143,1068.6445,133,1078.6445,79,1078.6445,79,1061.6445" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="92" y="1076.2129">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="506.5" y="1095.2129">Send notification to Participant (Payee) {1.1.4.a, 1.1.4.b}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="510.5" y="1110.5234"/><polygon fill="#A80036" points="117.5,1139.8867,107.5,1143.8867,117.5,1147.8867,113.5,1143.8867" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="383.5" y1="1143.8867" y2="1143.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="123.5" y="1139.1445">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="145.5" y="1139.1445">Send callback notification</text><!--
@startuml
title 1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification\nEvent Handler" as NOTIFY_HANDLER
boundary "Central\nService API" as CSAPI
collections "Prepare\nTopic\ndfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare\nEvent\nHandler" as PREP_HANDLER
collections "Position\nTopic\ndfsp1" as TOPIC_POSITION_DFSP1
control "Position\nEvent\nHandler" as POS_HANDLER
collections "Transfer\nTopic" as TOPIC_TRANSFERS
control "Transfer\nEvent\nHandler" as TRANS_HANDLER
collections "Notification\nTopic" as TOPIC_NOTIFICATIONS

box "Financial\nService Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate TRANS_HANDLER
group DFSP1 sends a Prepare Transfer request to DFSP2
    DFSP1 -> MLAPI: POST - /transfers\n(transferId, payerFsp,\npayeeFsp, amount,\ncurrency, ilpPacket,\ncondition, expiration)
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming\ntoken and originator\nmatching Payer
    MLAPI -> TOPIC_PREPARE_DFSP1: Produce prepare event for Payer\n(type: 'prepare', action: 'prepare')
    activate TOPIC_PREPARE_DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Event is\nreplicated as\nconfigured\n(ACKS=all)
    TOPIC_PREPARE_DFSP1 - -> MLAPI: Replication acknowledgements
    deactivate TOPIC_PREPARE_DFSP1
    MLAPI - - -> DFSP1: Respond HTTP -\n202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume
    ref over TOPIC_PREPARE_DFSP1, PREP_HANDLER, TOPIC_POSITION_DFSP1 :  Prepare Handler Consume {1.1.1.a, 1.1.1.b} \n
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Produce
    |||
    TOPIC_POSITION_DFSP1 <- POS_HANDLER: Consume
    ref over TOPIC_POSITION_DFSP1, POS_HANDLER, TOPIC_TRANSFERS : Position Handler Consume {1.1.2.a, 1.1.2.b} \n
    POS_HANDLER -> TOPIC_TRANSFERS: Produce
    |||
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume
    ref over TOPIC_TRANSFERS, TRANS_HANDLER, TOPIC_NOTIFICATIONS : Transfer Handler Consume {1.1.3.a, 1.2.3.b} \n
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Produce
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee) {1.1.4.a, 1.1.4.b} \n
    NOTIFY_HANDLER -> DFSP2: Send callback notification
    |||
end
deactivate TRANS_HANDLER
deactivate POS_HANDLER
deactivate PREP_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>