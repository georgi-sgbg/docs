<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2527px" preserveAspectRatio="none" style="width:1813px;height:2527px;" version="1.1" viewBox="0 0 1813 2527" width="1813px" zoomAndPan="magnify"><defs><filter height="300%" id="fmt14vfhlaxt1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="366" x="724.5" y="23.5352">1.1.1.a. Prepare Handler Consume (single message)</text><rect fill="#FFFFE0" height="2482.4336" style="stroke: #A80036; stroke-width: 1.0;" width="1730" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="833.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="2315.1465" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="409" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="877" y="1831.8516"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1160.5" y="2389.4336"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="899.7402"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="1282.1563"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410" y="451.3926"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410" y="675.5664"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="480.7031"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="704.877"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="929.0508"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="1311.4668"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="2301.1465" style="stroke: #000000; stroke-width: 2.0;" width="1789" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="767" x="325" y="216.9082"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="816.7637" style="stroke: #000000; stroke-width: 2.0;" width="1450" x="315" y="388.4609"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="412.7715"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="636.9453"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="861.1191"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="1208.209" style="stroke: #000000; stroke-width: 2.0;" width="1477" x="315" y="1219.2246"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1457" x="325" y="1243.5352"/><rect fill="#FFFFFF" height="557.582" style="stroke: none; stroke-width: 1.0;" width="1477" x="315" y="1869.8516"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="107" x2="107" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="414" x2="414" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="882" x2="882" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1029" x2="1029" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1165" x2="1165" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1298" x2="1298" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1415" x2="1415" y1="116.2871" y2="2451.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1697" x2="1697" y1="116.2871" y2="2451.4336"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="27" y="76.7988"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="23" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="101.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="27" y="2450.4336"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="23" y="2454.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="2474.9688">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="335" y="113.334">Prepare Event Handler</text><ellipse cx="414" cy="83.7988" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="410,71.7988,416,66.7988,414,71.7988,416,76.7988,410,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="335" y="2463.9688">Prepare Event Handler</text><ellipse cx="414" cy="2482.9219" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="410,2470.9219,416,2465.9219,414,2470.9219,416,2475.9219,410,2470.9219" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="801" y="76.7988"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="797" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="804" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="801" y="2450.4336"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="797" y="2454.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="804" y="2474.9688">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="981" y="76.7988"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="977" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="984" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="981" y="2450.4336"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="977" y="2454.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="984" y="2474.9688">Event-Topic</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1096" y="76.7988"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1092" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1099" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1096" y="2450.4336"/><rect fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1092" y="2454.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1099" y="2474.9688">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1249" y="113.334">Transfer DAO</text><ellipse cx="1298.5" cy="83.7988" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1286.5" x2="1310.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1249" y="2463.9688">Transfer DAO</text><ellipse cx="1298.5" cy="2482.9219" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1286.5" x2="1310.5" y1="2496.9219" y2="2496.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1358" y="113.334">Participant DAO</text><ellipse cx="1415" cy="83.7988" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1403" x2="1427" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1358" y="2463.9688">Participant DAO</text><ellipse cx="1415" cy="2482.9219" fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1403" x2="1427" y1="2496.9219" y2="2496.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1649" y="113.334">Central Store</text><path d="M1679,63.7988 C1679,53.7988 1697,53.7988 1697,53.7988 C1697,53.7988 1715,53.7988 1715,63.7988 L1715,89.7988 C1715,99.7988 1697,99.7988 1697,99.7988 C1697,99.7988 1679,99.7988 1679,89.7988 L1679,63.7988 " fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1679,63.7988 C1679,73.7988 1697,73.7988 1697,73.7988 C1697,73.7988 1715,73.7988 1715,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1649" y="2463.9688">Central Store</text><path d="M1679,2476.9219 C1679,2466.9219 1697,2466.9219 1697,2466.9219 C1697,2466.9219 1715,2466.9219 1715,2476.9219 L1715,2502.9219 C1715,2512.9219 1697,2512.9219 1697,2512.9219 C1697,2512.9219 1679,2512.9219 1679,2502.9219 L1679,2476.9219 " fill="#FEFECE" filter="url(#fmt14vfhlaxt1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1679,2476.9219 C1679,2486.9219 1697,2486.9219 1697,2486.9219 C1697,2486.9219 1715,2486.9219 1715,2476.9219 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="2315.1465" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="409" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="877" y="1831.8516"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1160.5" y="2389.4336"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="899.7402"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="1282.1563"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410" y="451.3926"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410" y="675.5664"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="480.7031"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="704.877"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="929.0508"/><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1692" y="1311.4668"/><path d="M13,133.2871 L236,133.2871 L236,140.2871 L226,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2301.1465" style="stroke: #000000; stroke-width: 2.0;" width="1789" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="146.8555">Prepare Handler Consume</text><polygon fill="#A80036" points="123,167.9082,113,171.9082,123,175.9082,119,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117" x2="408" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="129" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="142" y="167.166">Consume Prepare event message for Payer</text><path d="M325,216.9082 L540,216.9082 L540,223.9082 L530,233.9082 L325,233.9082 L325,216.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="767" x="325" y="216.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="340" y="230.4766">Persist Event Information</text><polygon fill="#A80036" points="1017.5,276.5293,1027.5,280.5293,1017.5,284.5293,1021.5,280.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1023.5" y1="280.5293" y2="280.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="426" y="275.7871">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="439" y="275.7871">Publish event information</text><rect fill="#FFFFFF" filter="url(#fmt14vfhlaxt1)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="749" x="332" y="288.5293"/><polygon fill="#EEEEEE" points="332,288.5293,396,288.5293,396,295.5293,386,305.5293,332,305.5293,332,288.5293" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="345" y="303.0977">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="607.5" y="322.0977">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="611.5" y="337.4082"/><path d="M315,388.4609 L534,388.4609 L534,395.4609 L524,405.4609 L315,405.4609 L315,388.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="816.7637" style="stroke: #000000; stroke-width: 2.0;" width="1450" x="315" y="388.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="330" y="402.0293">Validate Prepare Transfer</text><path d="M325,412.7715 L467,412.7715 L467,419.7715 L457,429.7715 L325,429.7715 L325,412.7715 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="412.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="340" y="426.3398">Validate Payer</text><polygon fill="#A80036" points="1398,447.3926,1408,451.3926,1398,455.3926,1402,451.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1404" y1="451.3926" y2="451.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="426" y="446.6504">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="439" y="446.6504">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1680,476.7031,1690,480.7031,1680,484.7031,1684,480.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1420" x2="1686" y1="480.7031" y2="480.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1427" y="475.9609">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1440" y="475.9609">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fmt14vfhlaxt1)" points="1663,493.7031,1731,493.7031,1741,504.7031,1731,516.7031,1663,516.7031,1653,504.7031,1663,493.7031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="1665" y="510.2715">particpant</text><polygon fill="#A80036" points="1431,539.3242,1421,543.3242,1431,547.3242,1427,543.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1425" x2="1696" y1="543.3242" y2="543.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1437" y="538.582">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1450" y="538.582">Return Participant details if it exists</text><polygon fill="#A80036" points="430,568.6348,420,572.6348,430,576.6348,426,572.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="1414" y1="572.6348" y2="572.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="436" y="567.8926">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="449" y="567.8926">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="601.9453" y2="601.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="601.9453" y2="614.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="614.9453" y2="614.9453"/><polygon fill="#A80036" points="430,610.9453,420,614.9453,430,618.9453,426,614.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="426" y="597.2031">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="439" y="597.2031">Validate Payer</text><path d="M325,636.9453 L469,636.9453 L469,643.9453 L459,653.9453 L325,653.9453 L325,636.9453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="636.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="340" y="650.5137">Validate Payee</text><polygon fill="#A80036" points="1398,671.5664,1408,675.5664,1398,679.5664,1402,675.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1404" y1="675.5664" y2="675.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="426" y="670.8242">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="439" y="670.8242">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1680,700.877,1690,704.877,1680,708.877,1684,704.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1420" x2="1686" y1="704.877" y2="704.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1427" y="700.1348">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1440" y="700.1348">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fmt14vfhlaxt1)" points="1663,717.877,1731,717.877,1741,728.877,1731,740.877,1663,740.877,1653,728.877,1663,717.877" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="1665" y="734.4453">particpant</text><polygon fill="#A80036" points="1431,763.498,1421,767.498,1431,771.498,1427,767.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1425" x2="1696" y1="767.498" y2="767.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1437" y="762.7559">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1459" y="762.7559">Return Participant details if it exists</text><polygon fill="#A80036" points="430,792.8086,420,796.8086,430,800.8086,426,796.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="1414" y1="796.8086" y2="796.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="436" y="792.0664">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="458" y="792.0664">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="826.1191" y2="826.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="826.1191" y2="839.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="839.1191" y2="839.1191"/><polygon fill="#A80036" points="430,835.1191,420,839.1191,430,843.1191,426,839.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="821.377">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="448" y="821.377">Validate Payee</text><path d="M325,861.1191 L477,861.1191 L477,868.1191 L467,878.1191 L325,878.1191 L325,861.1191 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1430" x="325" y="861.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="340" y="874.6875">Duplicate check</text><polygon fill="#A80036" points="1281.5,895.7402,1291.5,899.7402,1281.5,903.7402,1285.5,899.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1287.5" y1="899.7402" y2="899.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="894.998">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="448" y="894.998">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="1680,925.0508,1690,929.0508,1680,933.0508,1684,929.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1303.5" x2="1686" y1="929.0508" y2="929.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1310.5" y="924.3086">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1332.5" y="924.3086">Request Transfer</text><polygon fill="#FFFFE0" filter="url(#fmt14vfhlaxt1)" points="1662,942.0508,1731,942.0508,1741,953.0508,1731,965.0508,1662,965.0508,1652,953.0508,1662,942.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1664" y="958.6191">transfer</text><polygon fill="#A80036" points="1314.5,987.6719,1304.5,991.6719,1314.5,995.6719,1310.5,991.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1308.5" x2="1696" y1="991.6719" y2="991.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1320.5" y="986.9297">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1342.5" y="986.9297">Return Transfer if it exists</text><polygon fill="#A80036" points="430,1016.9824,420,1020.9824,430,1024.9824,426,1020.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="1297.5" y1="1020.9824" y2="1020.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="436" y="1016.2402">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="458" y="1016.2402">Return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="1050.293" y2="1050.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="1050.293" y2="1063.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="1063.293" y2="1063.293"/><polygon fill="#A80036" points="430,1059.293,420,1063.293,430,1067.293,426,1063.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1045.5508">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="448" y="1045.5508">Validate duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="1099.6035" y2="1099.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="1099.6035" y2="1112.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="1112.6035" y2="1112.6035"/><polygon fill="#A80036" points="430,1108.6035,420,1112.6035,430,1116.6035,426,1112.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1094.8613">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="448" y="1094.8613">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="1141.9141" y2="1141.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="1141.9141" y2="1154.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="1154.9141" y2="1154.9141"/><polygon fill="#A80036" points="430,1150.9141,420,1154.9141,430,1158.9141,426,1154.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1137.1719">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="448" y="1137.1719">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="461" y1="1184.2246" y2="1184.2246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="461" y1="1184.2246" y2="1197.2246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="461" y1="1197.2246" y2="1197.2246"/><polygon fill="#A80036" points="430,1193.2246,420,1197.2246,430,1201.2246,426,1197.2246" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1179.4824">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="448" y="1179.4824">Validate message signature (to be confirmed in future requirement)</text><path d="M315,1219.2246 L377,1219.2246 L377,1226.2246 L367,1236.2246 L315,1236.2246 L315,1219.2246 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1208.209" style="stroke: #000000; stroke-width: 2.0;" width="1477" x="315" y="1219.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="330" y="1232.793">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="206" x="392" y="1231.8594">[Validate Prepare Transfer (success)]</text><path d="M325,1243.5352 L856,1243.5352 L856,1250.5352 L846,1260.5352 L325,1260.5352 L325,1243.5352 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1457" x="325" y="1243.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="340" y="1257.1035">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1281.5,1278.1563,1291.5,1282.1563,1281.5,1286.1563,1285.5,1282.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1287.5" y1="1282.1563" y2="1282.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1277.4141">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="448" y="1277.4141">Request to persist transfer</text><polygon fill="#A80036" points="1680,1307.4668,1690,1311.4668,1680,1315.4668,1684,1311.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1303.5" x2="1686" y1="1311.4668" y2="1311.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1310.5" y="1306.7246">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1332.5" y="1306.7246">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#fmt14vfhlaxt1)" points="1631,1354.4668,1762,1354.4668,1772,1365.4668,1762,1377.4668,1631,1377.4668,1621,1365.4668,1631,1354.4668" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1633" y="1371.0352">transferStateChange</text><polygon fill="#A80036" points="430,1400.0879,420,1404.0879,430,1408.0879,426,1404.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="1297.5" y1="1404.0879" y2="1404.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="436" y="1399.3457">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="458" y="1399.3457">Return success</text><path d="M424,1424.0879 L424,1801.0879 L686,1801.0879 L686,1434.0879 L676,1424.0879 L424,1424.0879 " fill="#FFFF00" filter="url(#fmt14vfhlaxt1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676,1424.0879 L676,1434.0879 L686,1434.0879 L676,1424.0879 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="430" y="1441.6563">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="1456.9668">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="446" y="1472.2773">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="446" y="1487.5879">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="446" y="1502.8984">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="446" y="1518.209">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="446" y="1533.5195">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="462" y="1548.8301">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="462" y="1564.1406">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="446" y="1579.4512">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="446" y="1594.7617">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="462" y="1610.0723">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="478" y="1625.3828">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="478" y="1640.6934">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="478" y="1656.0039">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="478" y="1671.3145">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="478" y="1686.625">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="478" y="1701.9355">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="494" y="1717.2461">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="494" y="1732.5566">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="478" y="1747.8672">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="462" y="1763.1777">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="446" y="1778.4883">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="1793.7988">}</text><polygon fill="#A80036" points="865,1827.8516,875,1831.8516,865,1835.8516,869,1831.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="871" y1="1831.8516" y2="1831.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="1827.1094">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="448" y="1827.1094">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="315" x2="1792" y1="1870.8516" y2="1870.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="320" y="1881.4863">[Validate Prepare Transfer (failure)]</text><path d="M424,1889.8066 L424,2358.8066 L1031,2358.8066 L1031,1899.8066 L1021,1889.8066 L424,1889.8066 " fill="#FFFF00" filter="url(#fmt14vfhlaxt1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1021,1889.8066 L1021,1899.8066 L1031,1899.8066 L1021,1889.8066 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="430" y="1907.375">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="1922.6855">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="446" y="1937.9961">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="446" y="1953.3066">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="446" y="1968.6172">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="446" y="1983.9277">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="446" y="1999.2383">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="462" y="2014.5488">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="462" y="2029.8594">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="478" y="2045.1699">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="494" y="2060.4805">"errorCode": &lt;possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="494" y="2075.791">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="494" y="2091.1016">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="462" y="2106.4121">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="446" y="2121.7227">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="446" y="2137.0332">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="462" y="2152.3438">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="478" y="2167.6543">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="478" y="2182.9648">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="478" y="2198.2754">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="478" y="2213.5859">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="478" y="2228.8965">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="478" y="2244.207">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="494" y="2259.5176">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="494" y="2274.8281">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="494" y="2290.1387">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="478" y="2305.4492">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="462" y="2320.7598">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="446" y="2336.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="2351.3809">}</text><polygon fill="#A80036" points="1148.5,2385.4336,1158.5,2389.4336,1148.5,2393.4336,1152.5,2389.4336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="1154.5" y1="2389.4336" y2="2389.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="426" y="2384.6914">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="448" y="2384.6914">Publish Notification (failure) event for Payer</text><!--
@startuml
title 1.1.1.a. Prepare Handler Consume (single message)

autonumber


collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate PREP_HANDLER
group Prepare Handler Consume
    TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event message for Payer
    activate TOPIC_PREPARE_DFSP1
    deactivate TOPIC_PREPARE_DFSP1
    group Persist Event Information
        |||
        PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
        |||
    end

    group Validate Prepare Transfer
        group Validate Payer
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                particpant
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payer
        end
        group Validate Payee
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                particpant
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payee
        end
        group Duplicate check
            PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer
            hnote over DB #lightyellow
                transfer    
            end note
            activate DB
            TRANS_DAO <- - DB: Return Transfer if it exists
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return Transfer if it exists
            deactivate TRANS_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check
        end
        PREP_HANDLER <-> PREP_HANDLER: Validate amount
        PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
        PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
    end
    alt Validate Prepare Transfer (success)
        group Persist Transfer State (with transferState='RECEIVED' on validation pass)
            PREP_HANDLER -> TRANS_DAO: Request to persist transfer
            activate TRANS_DAO
            TRANS_DAO -> DB: Persist transfer
            hnote over DB #lightyellow
                transferStateChange
            end note
            activate DB
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return success
            deactivate TRANS_DAO
        end

        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1
    else Validate Prepare Transfer (failure)
        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <ledgerName>,
                to: <transferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>