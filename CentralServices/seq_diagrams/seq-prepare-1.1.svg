<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="10300px" preserveAspectRatio="none" style="width:5025px;height:10300px;" version="1.1" viewBox="0 0 5025 10300" width="5025px" zoomAndPan="magnify"><defs><filter height="300%" id="fmbu4mzqrrsr6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="2321" y="23.5352">1.1 DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="10255.082" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="9" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="12" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="10255.082" style="stroke: #A80036; stroke-width: 1.0;" width="590.5" x="298.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="515.25" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="10255.082" style="stroke: #A80036; stroke-width: 1.0;" width="3746.5" x="1231.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="3054.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="1138.875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="352.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="9156.834" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="763.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="3053.9785" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1844.5" y="1286.1621"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="6231.1367" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2764.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="8288.873" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3773.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="10031.7949" style="stroke: #000000; stroke-width: 2.0;" width="5001" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="3031.9785" style="stroke: #000000; stroke-width: 2.0;" width="3634.5" x="1369.5" y="1301.1621"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1354.7832"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="628.9004" style="stroke: #000000; stroke-width: 2.0;" width="3243.5" x="1750.5" y="1474.0254"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1498.3359"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1659.8887"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1821.4414"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2116.9258"/><rect fill="#FFFFFF" height="1683.209" style="stroke: none; stroke-width: 1.0;" width="3634.5" x="1369.5" y="2649.9316"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2701.1973"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="189.8633" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2820.4395"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="189.8633" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3024.3027"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3228.166"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="936.4219" style="stroke: #000000; stroke-width: 2.0;" width="3253.5" x="1740.5" y="3389.7188"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="638" x="1750.5" y="3414.0293"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="617" x="1760.5" y="3438.3398"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="618" x="1760.5" y="3511.9609"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="561" x="1760.5" y="3585.582"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3793.1348"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="2024.2832" style="stroke: #000000; stroke-width: 2.0;" width="2720.5" x="2283.5" y="4347.1406"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4400.7617"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="277.7949" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4520.0039"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4811.7988"/><rect fill="#FFFFFF" height="1026.6191" style="stroke: none; stroke-width: 1.0;" width="2720.5" x="2283.5" y="5344.8047"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5396.0703"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="849.1113" style="stroke: #000000; stroke-width: 2.0;" width="2324.5" x="2669.5" y="5515.3125"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="277.7949" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5539.623"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5831.418"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="2043.7363" style="stroke: #000000; stroke-width: 2.0;" width="2324.5" x="2669.5" y="6385.4238"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1297" x="3687" y="6439.0449"/><rect fill="#FFFFFF" height="1036.3457" style="stroke: none; stroke-width: 1.0;" width="2324.5" x="2669.5" y="7392.8145"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="7444.0801"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="858.8379" style="stroke: #000000; stroke-width: 2.0;" width="480" x="3687" y="7563.3223"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="860.9609" style="stroke: #000000; stroke-width: 2.0;" width="4981" x="23" y="8443.1602"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="829.6504" style="stroke: #000000; stroke-width: 2.0;" width="4961" x="33" y="8467.4707"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="8521.0918"/><rect fill="#FFFFFF" height="429.3027" style="stroke: none; stroke-width: 1.0;" width="4961" x="33" y="8867.8184"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="8919.084"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="193.1738" style="stroke: #000000; stroke-width: 2.0;" width="4941" x="43" y="9096.9473"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="860.9609" style="stroke: #000000; stroke-width: 2.0;" width="4981" x="23" y="9318.1211"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="829.6504" style="stroke: #000000; stroke-width: 2.0;" width="4961" x="33" y="9342.4316"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="9396.0527"/><rect fill="#FFFFFF" height="429.3027" style="stroke: none; stroke-width: 1.0;" width="4961" x="33" y="9742.7793"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="9794.0449"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="193.1738" style="stroke: #000000; stroke-width: 2.0;" width="4941" x="43" y="9971.9082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="74" x2="74" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="128" x2="128" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="357.5" x2="357.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="768" x2="768" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1302.5" x2="1302.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1463.5" x2="1463.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1849.5" x2="1849.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2378.5" x2="2378.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2769.5" x2="2769.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3386.5" x2="3386.5" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3778" x2="3778" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4083" x2="4083" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4215" x2="4215" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4312" x2="4312" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4410" x2="4410" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4530" x2="4530" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4657" x2="4657" y1="137.2871" y2="10203.082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4926" x2="4926" y1="137.2871" y2="10203.082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="53" y="134.334">Payer</text><ellipse cx="74.5" cy="63.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M74.5,71.7988 L74.5,98.7988 M61.5,79.7988 L87.5,79.7988 M74.5,98.7988 L61.5,113.7988 M74.5,98.7988 L87.5,113.7988 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="53" y="10215.6172">Payer</text><ellipse cx="74.5" cy="10228.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M74.5,10236.5703 L74.5,10263.5703 M61.5,10244.5703 L87.5,10244.5703 M74.5,10263.5703 L61.5,10278.5703 M74.5,10263.5703 L87.5,10278.5703 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="106" y="134.334">Payee</text><ellipse cx="128.5" cy="63.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M128.5,71.7988 L128.5,98.7988 M115.5,79.7988 L141.5,79.7988 M128.5,98.7988 L115.5,113.7988 M128.5,98.7988 L141.5,113.7988 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="106" y="10215.6172">Payee</text><ellipse cx="128.5" cy="10228.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M128.5,10236.5703 L128.5,10263.5703 M115.5,10244.5703 L141.5,10244.5703 M128.5,10263.5703 L115.5,10278.5703 M128.5,10263.5703 L141.5,10278.5703 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="302.5" y="134.334">ML API Adapter</text><path d="M337,92.7988 L337,116.7988 M337,104.7988 L354,104.7988 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="366" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="302.5" y="10215.6172">ML API Adapter</text><path d="M337,10222.5703 L337,10246.5703 M337,10234.5703 L354,10234.5703 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="366" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="652" y="134.334">ML API Notification Event Handler</text><ellipse cx="768.5" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="764.5,92.7988,770.5,87.7988,768.5,92.7988,770.5,97.7988,764.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="652" y="10215.6172">ML API Notification Event Handler</text><ellipse cx="768.5" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="764.5,10222.5703,770.5,10217.5703,768.5,10222.5703,770.5,10227.5703,764.5,10222.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1235.5" y="134.334">Central Service API</text><path d="M1282,92.7988 L1282,116.7988 M1282,104.7988 L1299,104.7988 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1311" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1235.5" y="10215.6172">Central Service API</text><path d="M1282,10222.5703 L1282,10246.5703 M1282,10234.5703 L1299,10234.5703 " fill="none" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1311" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1383.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1379.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1386.5" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1383.5" y="10202.082"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1379.5" y="10206.082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1386.5" y="10226.6172">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1770.5" y="134.334">Prepare Event Handler</text><ellipse cx="1849.5" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1845.5,92.7988,1851.5,87.7988,1849.5,92.7988,1851.5,97.7988,1845.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1770.5" y="10215.6172">Prepare Event Handler</text><ellipse cx="1849.5" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1845.5,10222.5703,1851.5,10217.5703,1849.5,10222.5703,1851.5,10227.5703,1845.5,10222.5703" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2297.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2293.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2300.5" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2297.5" y="10202.082"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2293.5" y="10206.082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2300.5" y="10226.6172">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2689.5" y="134.334">Position Event Handler</text><ellipse cx="2769.5" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2765.5,92.7988,2771.5,87.7988,2769.5,92.7988,2771.5,97.7988,2765.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2689.5" y="10215.6172">Position Event Handler</text><ellipse cx="2769.5" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2765.5,10222.5703,2771.5,10217.5703,2769.5,10222.5703,2771.5,10227.5703,2765.5,10222.5703" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3327.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3323.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="3330.5" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3327.5" y="10202.082"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3323.5" y="10206.082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="3330.5" y="10226.6172">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3697" y="134.334">Transfer Event Handler</text><ellipse cx="3778.5" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3774.5,92.7988,3780.5,87.7988,3778.5,92.7988,3780.5,97.7988,3774.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3697" y="10215.6172">Transfer Event Handler</text><ellipse cx="3778.5" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3774.5,10222.5703,3780.5,10217.5703,3778.5,10222.5703,3780.5,10227.5703,3774.5,10222.5703" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="4014" y="97.7988"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="4010" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="4017" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="4014" y="10202.082"/><rect fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="4010" y="10206.082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="4017" y="10226.6172">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4167" y="134.334">Position DAO</text><ellipse cx="4215" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4203" x2="4227" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4167" y="10215.6172">Position DAO</text><ellipse cx="4215" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4203" x2="4227" y1="10248.5703" y2="10248.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="4273" y="134.334">Event DAO</text><ellipse cx="4312" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4300" x2="4324" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="4273" y="10215.6172">Event DAO</text><ellipse cx="4312" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4300" x2="4324" y1="10248.5703" y2="10248.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="4361" y="134.334">Transfer DAO</text><ellipse cx="4410.5" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4398.5" x2="4422.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="4361" y="10215.6172">Transfer DAO</text><ellipse cx="4410.5" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4398.5" x2="4422.5" y1="10248.5703" y2="10248.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="4470" y="134.334">Notification DAO</text><ellipse cx="4530" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4518" x2="4542" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="4470" y="10215.6172">Notification DAO</text><ellipse cx="4530" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4518" x2="4542" y1="10248.5703" y2="10248.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="4600" y="134.334">Participant DAO</text><ellipse cx="4657" cy="104.7988" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4645" x2="4669" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="4600" y="10215.6172">Participant DAO</text><ellipse cx="4657" cy="10234.5703" fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4645" x2="4669" y1="10248.5703" y2="10248.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4878" y="134.334">Central Store</text><path d="M4908,84.7988 C4908,74.7988 4926,74.7988 4926,74.7988 C4926,74.7988 4944,74.7988 4944,84.7988 L4944,110.7988 C4944,120.7988 4926,120.7988 4926,120.7988 C4926,120.7988 4908,120.7988 4908,110.7988 L4908,84.7988 " fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4908,84.7988 C4908,94.7988 4926,94.7988 4926,94.7988 C4926,94.7988 4944,94.7988 4944,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4878" y="10215.6172">Central Store</text><path d="M4908,10228.5703 C4908,10218.5703 4926,10218.5703 4926,10218.5703 C4926,10218.5703 4944,10218.5703 4944,10228.5703 L4944,10254.5703 C4944,10264.5703 4926,10264.5703 4926,10264.5703 C4926,10264.5703 4908,10264.5703 4908,10254.5703 L4908,10228.5703 " fill="#FEFECE" filter="url(#fmbu4mzqrrsr6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4908,10228.5703 C4908,10238.5703 4926,10238.5703 4926,10238.5703 C4926,10238.5703 4944,10238.5703 4944,10228.5703 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="1138.875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="352.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="9156.834" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="763.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="3053.9785" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1844.5" y="1286.1621"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="6231.1367" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2764.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fmbu4mzqrrsr6)" height="8288.873" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3773.5" y="147.2871"/><path d="M13,154.2871 L391,154.2871 L391,161.2871 L381,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="10031.7949" style="stroke: #000000; stroke-width: 2.0;" width="5001" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="333" x="28" y="167.8555">DFSP1 sends a Prepare Transfer request to Payee</text><path d="M79,176.5977 L79,706.5977 L420,706.5977 L420,186.5977 L410,176.5977 L79,176.5977 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M410,176.5977 L410,186.5977 L420,186.5977 L410,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="85" y="194.166">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="101" y="209.4766">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="101" y="224.7871">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="101" y="240.0977">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="101" y="255.4082">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="101" y="270.7188">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="101" y="286.0293">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="101" y="301.3398">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="101" y="316.6504">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="101" y="331.9609">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="101" y="347.2715">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="85" y="362.582">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="89" y="377.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="85" y="393.2031">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="85" y="408.5137">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="101" y="423.8242">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="101" y="439.1348">"payeeFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="101" y="454.4453">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="101" y="469.7559">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="117" y="485.0664">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="117" y="500.377">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="101" y="515.6875">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="101" y="530.998">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="101" y="546.3086">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="101" y="561.6191">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="101" y="576.9297">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="117" y="592.2402">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="133" y="607.5508">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="149" y="622.8613">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="149" y="638.1719">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="133" y="653.4824">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="117" y="668.793">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="101" y="684.1035">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="85" y="699.4141">}</text><polygon fill="#A80036" points="340.5,733.4668,350.5,737.4668,340.5,741.4668,344.5,737.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74.5" x2="346.5" y1="737.4668" y2="737.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="81.5" y="732.7246">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="94.5" y="732.7246">POST - http://transfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="362.5" x2="404.5" y1="766.7773" y2="766.7773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404.5" x2="404.5" y1="766.7773" y2="779.7773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363.5" x2="404.5" y1="779.7773" y2="779.7773"/><polygon fill="#A80036" points="373.5,775.7773,363.5,779.7773,373.5,783.7773,369.5,779.7773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="369.5" y="762.0352">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="382.5" y="762.0352">validates incoming token, and the originator matches Payer</text><path d="M367,792.7773 L367,1154.7773 L629,1154.7773 L629,802.7773 L619,792.7773 L367,792.7773 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M619,792.7773 L619,802.7773 L629,802.7773 L619,792.7773 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="373" y="810.3457">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="373" y="825.6563">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="389" y="840.9668">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="389" y="856.2773">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="389" y="871.5879">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="389" y="886.8984">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="389" y="902.209">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="405" y="917.5195">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="405" y="932.8301">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="389" y="948.1406">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="389" y="963.4512">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="405" y="978.7617">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="421" y="994.0723">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="421" y="1009.3828">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="421" y="1024.6934">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="421" y="1040.0039">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="421" y="1055.3145">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="437" y="1070.625">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="437" y="1085.9355">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="421" y="1101.2461">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="405" y="1116.5566">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="389" y="1131.8672">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="373" y="1147.1777">}</text><polygon fill="#A80036" points="1451.5,1181.2305,1461.5,1185.2305,1451.5,1189.2305,1455.5,1185.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="362.5" x2="1457.5" y1="1185.2305" y2="1185.2305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="369.5" y="1180.4883">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="382.5" y="1180.4883">Routes &amp; Publishes Prepare event for Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1463.5" x2="1505.5" y1="1214.541" y2="1214.541"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1505.5" x2="1505.5" y1="1214.541" y2="1227.541"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1464.5" x2="1505.5" y1="1227.541" y2="1227.541"/><polygon fill="#A80036" points="1474.5,1223.541,1464.5,1227.541,1474.5,1231.541,1470.5,1227.541" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1470.5" y="1209.7988">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1483.5" y="1209.7988">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="373.5,1252.8516,363.5,1256.8516,373.5,1260.8516,369.5,1256.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="367.5" x2="1462.5" y1="1256.8516" y2="1256.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="379.5" y="1252.1094">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="392.5" y="1252.1094">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="85.5,1282.1621,75.5,1286.1621,85.5,1290.1621,81.5,1286.1621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="79.5" x2="356.5" y1="1286.1621" y2="1286.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="91.5" y="1281.4199">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="104.5" y="1281.4199">Respond HTTP - 202 (Accepted)</text><path d="M1369.5,1301.1621 L1431.5,1301.1621 L1431.5,1308.1621 L1421.5,1318.1621 L1369.5,1318.1621 L1369.5,1301.1621 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3031.9785" style="stroke: #000000; stroke-width: 2.0;" width="3634.5" x="1369.5" y="1301.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1384.5" y="1314.7305">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="1446.5" y="1313.7969">[Prepare Handler consume Single Message]</text><polygon fill="#A80036" points="1832.5,1335.7832,1842.5,1339.7832,1832.5,1343.7832,1836.5,1339.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1463.5" x2="1838.5" y1="1339.7832" y2="1339.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1470.5" y="1335.041">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1483.5" y="1335.041">Consumes Prepare event message for Payer</text><path d="M1760.5,1354.7832 L1975.5,1354.7832 L1975.5,1361.7832 L1965.5,1371.7832 L1760.5,1371.7832 L1760.5,1354.7832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1354.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="1775.5" y="1368.3516">Persist Event Information</text><polygon fill="#A80036" points="4300,1389.4043,4310,1393.4043,4300,1397.4043,4304,1393.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4306" y1="1393.4043" y2="1393.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1861.5" y="1388.6621">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1874.5" y="1388.6621">Request to persist event information</text><polygon fill="#A80036" points="4323,1418.7148,4313,1422.7148,4323,1426.7148,4319,1422.7148" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,1418.7148,4924,1422.7148,4914,1426.7148,4918,1422.7148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="1422.7148" y2="1422.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="4329" y="1417.9727">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4342" y="1417.9727">Persist event information</text><polygon fill="#A80036" points="1865.5,1448.0254,1855.5,1452.0254,1865.5,1456.0254,1861.5,1452.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4311" y1="1452.0254" y2="1452.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="1447.2832">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1893.5" y="1447.2832">return success</text><path d="M1750.5,1474.0254 L1969.5,1474.0254 L1969.5,1481.0254 L1959.5,1491.0254 L1750.5,1491.0254 L1750.5,1474.0254 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="628.9004" style="stroke: #000000; stroke-width: 2.0;" width="3243.5" x="1750.5" y="1474.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="1765.5" y="1487.5938">Validate Prepare Transfer</text><path d="M1760.5,1498.3359 L1902.5,1498.3359 L1902.5,1505.3359 L1892.5,1515.3359 L1760.5,1515.3359 L1760.5,1498.3359 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1498.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="1775.5" y="1511.9043">Validate Payer</text><polygon fill="#A80036" points="4645,1532.957,4655,1536.957,4645,1540.957,4649,1536.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4651" y1="1536.957" y2="1536.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1532.2148">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="1883.5" y="1532.2148">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="4668,1562.2676,4658,1566.2676,4668,1570.2676,4664,1566.2676" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,1562.2676,4924,1566.2676,4914,1570.2676,4918,1566.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4662" x2="4920" y1="1566.2676" y2="1566.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4674" y="1561.5254">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="4696" y="1561.5254">return Participant details if it exists</text><polygon fill="#A80036" points="1865.5,1591.5781,1855.5,1595.5781,1865.5,1599.5781,1861.5,1595.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4656" y1="1595.5781" y2="1595.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="1590.8359">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1893.5" y="1590.8359">return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="1624.8887" y2="1624.8887"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="1624.8887" y2="1637.8887"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="1637.8887" y2="1637.8887"/><polygon fill="#A80036" points="1865.5,1633.8887,1855.5,1637.8887,1865.5,1641.8887,1861.5,1637.8887" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1620.1465">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1883.5" y="1620.1465">Validates Payer</text><path d="M1760.5,1659.8887 L1904.5,1659.8887 L1904.5,1666.8887 L1894.5,1676.8887 L1760.5,1676.8887 L1760.5,1659.8887 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1659.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="1775.5" y="1673.457">Validate Payee</text><polygon fill="#A80036" points="4645,1694.5098,4655,1698.5098,4645,1702.5098,4649,1698.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4651" y1="1698.5098" y2="1698.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1693.7676">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="1883.5" y="1693.7676">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="4668,1723.8203,4658,1727.8203,4668,1731.8203,4664,1727.8203" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,1723.8203,4924,1727.8203,4914,1731.8203,4918,1727.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4662" x2="4920" y1="1727.8203" y2="1727.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4674" y="1723.0781">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="4696" y="1723.0781">return Participant details if it exists</text><polygon fill="#A80036" points="1865.5,1753.1309,1855.5,1757.1309,1865.5,1761.1309,1861.5,1757.1309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4656" y1="1757.1309" y2="1757.1309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="1752.3887">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1893.5" y="1752.3887">return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="1786.4414" y2="1786.4414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="1786.4414" y2="1799.4414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="1799.4414" y2="1799.4414"/><polygon fill="#A80036" points="1865.5,1795.4414,1855.5,1799.4414,1865.5,1803.4414,1861.5,1799.4414" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1781.6992">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="1883.5" y="1781.6992">Validates Payee</text><path d="M1760.5,1821.4414 L1912.5,1821.4414 L1912.5,1828.4414 L1902.5,1838.4414 L1760.5,1838.4414 L1760.5,1821.4414 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="1821.4414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="1775.5" y="1835.0098">Duplicate check</text><polygon fill="#A80036" points="4398.5,1856.0625,4408.5,1860.0625,4398.5,1864.0625,4402.5,1860.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4404.5" y1="1860.0625" y2="1860.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1855.3203">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1883.5" y="1855.3203">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="4421.5,1885.373,4411.5,1889.373,4421.5,1893.373,4417.5,1889.373" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,1885.373,4924,1889.373,4914,1893.373,4918,1889.373" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="1889.373" y2="1889.373"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="1884.6309">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="4449.5" y="1884.6309">return Transfer if it exists</text><polygon fill="#A80036" points="1865.5,1914.6836,1855.5,1918.6836,1865.5,1922.6836,1861.5,1918.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4409.5" y1="1918.6836" y2="1918.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="1913.9414">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1893.5" y="1913.9414">return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="1947.9941" y2="1947.9941"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="1947.9941" y2="1960.9941"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="1960.9941" y2="1960.9941"/><polygon fill="#A80036" points="1865.5,1956.9941,1855.5,1960.9941,1865.5,1964.9941,1861.5,1960.9941" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1943.252">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1883.5" y="1943.252">Validates duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="1997.3047" y2="1997.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="1997.3047" y2="2010.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="2010.3047" y2="2010.3047"/><polygon fill="#A80036" points="1865.5,2006.3047,1855.5,2010.3047,1865.5,2014.3047,1861.5,2010.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="1992.5625">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1883.5" y="1992.5625">Validates amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="2039.6152" y2="2039.6152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="2039.6152" y2="2052.6152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="2052.6152" y2="2052.6152"/><polygon fill="#A80036" points="1865.5,2048.6152,1855.5,2052.6152,1865.5,2056.6152,1861.5,2052.6152" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2034.873">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1883.5" y="2034.873">Validates crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="2081.9258" y2="2081.9258"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="2081.9258" y2="2094.9258"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="2094.9258" y2="2094.9258"/><polygon fill="#A80036" points="1865.5,2090.9258,1855.5,2094.9258,1865.5,2098.9258,1861.5,2094.9258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2077.1836">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1883.5" y="2077.1836">Validates message signature (to be confirmed in future requirement)</text><path d="M1760.5,2116.9258 L2281.5,2116.9258 L2281.5,2123.9258 L2271.5,2133.9258 L1760.5,2133.9258 L1760.5,2116.9258 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2116.9258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="476" x="1775.5" y="2130.4941">Persist Transfer State with transferState='RECEIVED' on validation pass</text><polygon fill="#A80036" points="4398.5,2151.5469,4408.5,2155.5469,4398.5,2159.5469,4402.5,2155.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4404.5" y1="2155.5469" y2="2155.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2150.8047">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1883.5" y="2150.8047">Request to persist transfer</text><polygon fill="#A80036" points="4421.5,2180.8574,4411.5,2184.8574,4421.5,2188.8574,4417.5,2184.8574" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,2180.8574,4924,2184.8574,4914,2188.8574,4918,2184.8574" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="2184.8574" y2="2184.8574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="2180.1152">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="4449.5" y="2180.1152">Persist transfer</text><polygon fill="#A80036" points="1865.5,2210.168,1855.5,2214.168,1865.5,2218.168,1861.5,2214.168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4409.5" y1="2214.168" y2="2214.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="2209.4258">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1893.5" y="2209.4258">return success</text><path d="M1859,2234.168 L1859,2611.168 L2121,2611.168 L2121,2244.168 L2111,2234.168 L1859,2234.168 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2111,2234.168 L2111,2244.168 L2121,2244.168 L2111,2234.168 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1865" y="2251.7363">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1865" y="2267.0469">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1881" y="2282.3574">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="1881" y="2297.668">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1881" y="2312.9785">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1881" y="2328.2891">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1881" y="2343.5996">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1897" y="2358.9102">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1897" y="2374.2207">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1881" y="2389.5313">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1881" y="2404.8418">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1897" y="2420.1523">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1913" y="2435.4629">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1913" y="2450.7734">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1913" y="2466.084">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1913" y="2481.3945">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1913" y="2496.7051">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1913" y="2512.0156">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1929" y="2527.3262">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1929" y="2542.6367">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1913" y="2557.9473">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1897" y="2573.2578">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1881" y="2588.5684">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1865" y="2603.8789">}</text><polygon fill="#A80036" points="2366.5,2637.9316,2376.5,2641.9316,2366.5,2645.9316,2370.5,2641.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="2372.5" y1="2641.9316" y2="2641.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2637.1895">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1883.5" y="2637.1895">Routes &amp; Publishes Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1369.5" x2="5004" y1="2650.9316" y2="2650.9316"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="1374.5" y="2661.5664">[Prepare Handler consume batch Messages]</text><polygon fill="#A80036" points="1832.5,2682.1973,1842.5,2686.1973,1832.5,2690.1973,1836.5,2686.1973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1463.5" x2="1838.5" y1="2686.1973" y2="2686.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1470.5" y="2681.4551">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="1492.5" y="2681.4551">Consumes Prepare event batch of messages for Payer</text><path d="M1760.5,2701.1973 L2017.5,2701.1973 L2017.5,2708.1973 L2007.5,2718.1973 L1760.5,2718.1973 L1760.5,2701.1973 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2701.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="1775.5" y="2714.7656">Persist batch Event Information</text><polygon fill="#A80036" points="4300,2735.8184,4310,2739.8184,4300,2743.8184,4304,2739.8184" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4306" y1="2739.8184" y2="2739.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2735.0762">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="1883.5" y="2735.0762">Request to persist event information for batch of messages</text><polygon fill="#A80036" points="4323,2765.1289,4313,2769.1289,4323,2773.1289,4319,2769.1289" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,2765.1289,4924,2769.1289,4914,2773.1289,4918,2769.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="2769.1289" y2="2769.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4329" y="2764.3867">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="4351" y="2764.3867">Persist event batch information</text><polygon fill="#A80036" points="1865.5,2794.4395,1855.5,2798.4395,1865.5,2802.4395,1861.5,2798.4395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4311" y1="2798.4395" y2="2798.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="2793.6973">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1893.5" y="2793.6973">return success</text><path d="M1760.5,2820.4395 L2008.5,2820.4395 L2008.5,2827.4395 L1998.5,2837.4395 L1760.5,2837.4395 L1760.5,2820.4395 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="189.8633" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="2820.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="1775.5" y="2834.0078">Fetch batch Payer information</text><polygon fill="#A80036" points="4645,2855.0605,4655,2859.0605,4645,2863.0605,4649,2859.0605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4651" y1="2859.0605" y2="2859.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2854.3184">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="1883.5" y="2854.3184">Request to retrieve batch of Payer Participant details (if it exists)</text><polygon fill="#A80036" points="4668,2884.3711,4658,2888.3711,4668,2892.3711,4664,2888.3711" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,2884.3711,4924,2888.3711,4914,2892.3711,4918,2888.3711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4662" x2="4920" y1="2888.3711" y2="2888.3711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4674" y="2883.6289">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="4696" y="2883.6289">return Participant details if it exists</text><polygon fill="#A80036" points="1865.5,2913.6816,1855.5,2917.6816,1865.5,2921.6816,1861.5,2917.6816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4656" y1="2917.6816" y2="2917.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="2912.9395">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1893.5" y="2912.9395">return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="2946.9922" y2="2946.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="2946.9922" y2="2959.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="2959.9922" y2="2959.9922"/><polygon fill="#A80036" points="1865.5,2955.9922,1855.5,2959.9922,1865.5,2963.9922,1861.5,2959.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2942.25">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1883.5" y="2942.25">Validates Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="2989.3027" y2="2989.3027"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="2989.3027" y2="3002.3027"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3002.3027" y2="3002.3027"/><polygon fill="#A80036" points="1865.5,2998.3027,1855.5,3002.3027,1865.5,3006.3027,1861.5,3002.3027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="2984.5605">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="1883.5" y="2984.5605">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M1760.5,3024.3027 L2010.5,3024.3027 L2010.5,3031.3027 L2000.5,3041.3027 L1760.5,3041.3027 L1760.5,3024.3027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="189.8633" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3024.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="1775.5" y="3037.8711">Fetch batch Payee information</text><polygon fill="#A80036" points="4645,3058.9238,4655,3062.9238,4645,3066.9238,4649,3062.9238" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4651" y1="3062.9238" y2="3062.9238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3058.1816">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="1883.5" y="3058.1816">Request to retrieve batch of Payee Participant details (if it exists)</text><polygon fill="#A80036" points="4668,3088.2344,4658,3092.2344,4668,3096.2344,4664,3092.2344" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,3088.2344,4924,3092.2344,4914,3096.2344,4918,3092.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4662" x2="4920" y1="3092.2344" y2="3092.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4674" y="3087.4922">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="4696" y="3087.4922">return Participant details if it exists</text><polygon fill="#A80036" points="1865.5,3117.5449,1855.5,3121.5449,1865.5,3125.5449,1861.5,3121.5449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4656" y1="3121.5449" y2="3121.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="3116.8027">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1893.5" y="3116.8027">return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3150.8555" y2="3150.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3150.8555" y2="3163.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3163.8555" y2="3163.8555"/><polygon fill="#A80036" points="1865.5,3159.8555,1855.5,3163.8555,1865.5,3167.8555,1861.5,3163.8555" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3146.1133">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="1883.5" y="3146.1133">Validates Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3193.166" y2="3193.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3193.166" y2="3206.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3206.166" y2="3206.166"/><polygon fill="#A80036" points="1865.5,3202.166,1855.5,3206.166,1865.5,3210.166,1861.5,3206.166" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3188.4238">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="1883.5" y="3188.4238">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M1760.5,3228.166 L1965.5,3228.166 L1965.5,3235.166 L1955.5,3245.166 L1760.5,3245.166 L1760.5,3228.166 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="147.5527" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3228.166"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="1775.5" y="3241.7344">Fetch batch of transfers</text><polygon fill="#A80036" points="4398.5,3262.7871,4408.5,3266.7871,4398.5,3270.7871,4402.5,3266.7871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4404.5" y1="3266.7871" y2="3266.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3262.0449">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="1883.5" y="3262.0449">Request to retrieve batch of Transfers (if it exists)</text><polygon fill="#A80036" points="4421.5,3292.0977,4411.5,3296.0977,4421.5,3300.0977,4417.5,3296.0977" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,3292.0977,4924,3296.0977,4914,3300.0977,4918,3296.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="3296.0977" y2="3296.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="3291.3555">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="4449.5" y="3291.3555">return batch of Transfers (if it exists)</text><polygon fill="#A80036" points="1865.5,3321.4082,1855.5,3325.4082,1865.5,3329.4082,1861.5,3325.4082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4409.5" y1="3325.4082" y2="3325.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="3320.666">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1893.5" y="3320.666">return batch of Transfer (if it exists)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3354.7188" y2="3354.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3354.7188" y2="3367.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3367.7188" y2="3367.7188"/><polygon fill="#A80036" points="1865.5,3363.7188,1855.5,3367.7188,1865.5,3371.7188,1861.5,3367.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3349.9766">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="1883.5" y="3349.9766">store result set in var: $LIST_TRANSFERS</text><path d="M1740.5,3389.7188 L1814.5,3389.7188 L1814.5,3396.7188 L1804.5,3406.7188 L1740.5,3406.7188 L1740.5,3389.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="936.4219" style="stroke: #000000; stroke-width: 2.0;" width="3253.5" x="1740.5" y="3389.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1755.5" y="3403.2871">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="1829.5" y="3402.3535">[for each message in batch]</text><path d="M1750.5,3414.0293 L1969.5,3414.0293 L1969.5,3421.0293 L1959.5,3431.0293 L1750.5,3431.0293 L1750.5,3414.0293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="638" x="1750.5" y="3414.0293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="1765.5" y="3427.5977">Validate Prepare Transfer</text><path d="M1760.5,3438.3398 L1902.5,3438.3398 L1902.5,3445.3398 L1892.5,3455.3398 L1760.5,3455.3398 L1760.5,3438.3398 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="617" x="1760.5" y="3438.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="1775.5" y="3451.9082">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3476.9609" y2="3476.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3476.9609" y2="3489.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3489.9609" y2="3489.9609"/><polygon fill="#A80036" points="1865.5,3485.9609,1855.5,3489.9609,1865.5,3493.9609,1861.5,3489.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3472.2188">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="1883.5" y="3472.2188">Validates Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M1760.5,3511.9609 L1904.5,3511.9609 L1904.5,3518.9609 L1894.5,3528.9609 L1760.5,3528.9609 L1760.5,3511.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="618" x="1760.5" y="3511.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="1775.5" y="3525.5293">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3550.582" y2="3550.582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3550.582" y2="3563.582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3563.582" y2="3563.582"/><polygon fill="#A80036" points="1865.5,3559.582,1855.5,3563.582,1865.5,3567.582,1861.5,3563.582" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3545.8398">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="483" x="1883.5" y="3545.8398">Validates Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M1760.5,3585.582 L1912.5,3585.582 L1912.5,3592.582 L1902.5,3602.582 L1760.5,3602.582 L1760.5,3585.582 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="561" x="1760.5" y="3585.582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="1775.5" y="3599.1504">Duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3624.2031" y2="3624.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3624.2031" y2="3637.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3637.2031" y2="3637.2031"/><polygon fill="#A80036" points="1865.5,3633.2031,1855.5,3637.2031,1865.5,3641.2031,1861.5,3637.2031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3619.4609">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="1883.5" y="3619.4609">Validates duplicate Check against in-memory var $LIST_TRANSFERS</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3673.5137" y2="3673.5137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3673.5137" y2="3686.5137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3686.5137" y2="3686.5137"/><polygon fill="#A80036" points="1865.5,3682.5137,1855.5,3686.5137,1865.5,3690.5137,1861.5,3686.5137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3668.7715">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1883.5" y="3668.7715">Validates amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3715.8242" y2="3715.8242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3715.8242" y2="3728.8242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3728.8242" y2="3728.8242"/><polygon fill="#A80036" points="1865.5,3724.8242,1855.5,3728.8242,1865.5,3732.8242,1861.5,3728.8242" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3711.082">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1883.5" y="3711.082">Validates crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="1896.5" y1="3758.1348" y2="3758.1348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1896.5" x2="1896.5" y1="3758.1348" y2="3771.1348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1855.5" x2="1896.5" y1="3771.1348" y2="3771.1348"/><polygon fill="#A80036" points="1865.5,3767.1348,1855.5,3771.1348,1865.5,3775.1348,1861.5,3771.1348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3753.3926">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1883.5" y="3753.3926">Validates message signature (to be confirmed in future requirement)</text><path d="M1760.5,3793.1348 L2281.5,3793.1348 L2281.5,3800.1348 L2271.5,3810.1348 L1760.5,3810.1348 L1760.5,3793.1348 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="3223.5" x="1760.5" y="3793.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="476" x="1775.5" y="3806.7031">Persist Transfer State with transferState='RECEIVED' on validation pass</text><polygon fill="#A80036" points="4398.5,3827.7559,4408.5,3831.7559,4398.5,3835.7559,4402.5,3831.7559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="4404.5" y1="3831.7559" y2="3831.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="3827.0137">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1883.5" y="3827.0137">Request to persist transfer</text><polygon fill="#A80036" points="4421.5,3857.0664,4411.5,3861.0664,4421.5,3865.0664,4417.5,3861.0664" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,3857.0664,4924,3861.0664,4914,3865.0664,4918,3861.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="3861.0664" y2="3861.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="3856.3242">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="4449.5" y="3856.3242">Persist transfer</text><polygon fill="#A80036" points="1865.5,3886.377,1855.5,3890.377,1865.5,3894.377,1861.5,3890.377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1859.5" x2="4409.5" y1="3890.377" y2="3890.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1871.5" y="3885.6348">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1893.5" y="3885.6348">return success</text><path d="M1859,3910.377 L1859,4287.377 L2121,4287.377 L2121,3920.377 L2111,3910.377 L1859,3910.377 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2111,3910.377 L2111,3920.377 L2121,3920.377 L2111,3910.377 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1865" y="3927.9453">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1865" y="3943.2559">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1881" y="3958.5664">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="1881" y="3973.877">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1881" y="3989.1875">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1881" y="4004.498">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1881" y="4019.8086">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1897" y="4035.1191">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1897" y="4050.4297">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1881" y="4065.7402">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1881" y="4081.0508">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1897" y="4096.3613">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1913" y="4111.6719">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1913" y="4126.9824">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1913" y="4142.293">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1913" y="4157.6035">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1913" y="4172.9141">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1913" y="4188.2246">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1929" y="4203.5352">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1929" y="4218.8457">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1913" y="4234.1563">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1897" y="4249.4668">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1881" y="4264.7773">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1865" y="4280.0879">}</text><polygon fill="#A80036" points="2366.5,4314.1406,2376.5,4318.1406,2366.5,4322.1406,2370.5,4318.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="2372.5" y1="4318.1406" y2="4318.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1861.5" y="4313.3984">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1883.5" y="4313.3984">Routes &amp; Publishes Position event for Payer</text><path d="M2283.5,4347.1406 L2345.5,4347.1406 L2345.5,4354.1406 L2335.5,4364.1406 L2283.5,4364.1406 L2283.5,4347.1406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2024.2832" style="stroke: #000000; stroke-width: 2.0;" width="2720.5" x="2283.5" y="4347.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="2298.5" y="4360.709">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="2360.5" y="4359.7754">[Position Handler consume Single Message]</text><polygon fill="#A80036" points="2752.5,4381.7617,2762.5,4385.7617,2752.5,4389.7617,2756.5,4385.7617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2378.5" x2="2758.5" y1="4385.7617" y2="4385.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2385.5" y="4381.0195">58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="2407.5" y="4381.0195">Consumes Position event message for Payer</text><path d="M2679.5,4400.7617 L2894.5,4400.7617 L2894.5,4407.7617 L2884.5,4417.7617 L2679.5,4417.7617 L2679.5,4400.7617 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4400.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="2694.5" y="4414.3301">Persist Event Information</text><polygon fill="#A80036" points="4300,4435.3828,4310,4439.3828,4300,4443.3828,4304,4439.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4306" y1="4439.3828" y2="4439.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4434.6406">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2803.5" y="4434.6406">Request to persist event information</text><polygon fill="#A80036" points="4323,4464.6934,4313,4468.6934,4323,4472.6934,4319,4468.6934" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,4464.6934,4924,4468.6934,4914,4472.6934,4918,4468.6934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="4468.6934" y2="4468.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4329" y="4463.9512">60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4351" y="4463.9512">Persist event information</text><polygon fill="#A80036" points="2785.5,4494.0039,2775.5,4498.0039,2785.5,4502.0039,2781.5,4498.0039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4311" y1="4498.0039" y2="4498.0039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="4493.2617">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="4493.2617">return success</text><path d="M2679.5,4520.0039 L2978.5,4520.0039 L2978.5,4527.0039 L2968.5,4537.0039 L2679.5,4537.0039 L2679.5,4520.0039 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="277.7949" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4520.0039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="2694.5" y="4533.5723">Calculate position and persist change</text><polygon fill="#A80036" points="4203,4554.625,4213,4558.625,4203,4562.625,4207,4558.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4209" y1="4558.625" y2="4558.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4553.8828">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="2803.5" y="4553.8828">Request latest position from DB for Payer</text><polygon fill="#A80036" points="4226,4583.9355,4216,4587.9355,4226,4591.9355,4222,4587.9355" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,4583.9355,4924,4587.9355,4914,4591.9355,4918,4587.9355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4220" x2="4920" y1="4587.9355" y2="4587.9355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4232" y="4583.1934">63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="4254" y="4583.1934">Retrieves latest position from DB for Payer</text><polygon fill="#A80036" points="2785.5,4613.2461,2775.5,4617.2461,2785.5,4621.2461,2781.5,4617.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4214" y1="4617.2461" y2="4617.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="4612.5039">64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="2813.5" y="4612.5039">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="2816.5" y1="4646.5566" y2="4646.5566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2816.5" x2="2816.5" y1="4646.5566" y2="4659.5566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2775.5" x2="2816.5" y1="4659.5566" y2="4659.5566"/><polygon fill="#A80036" points="2785.5,4655.5566,2775.5,4659.5566,2785.5,4663.5566,2781.5,4659.5566" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4641.8145">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="2803.5" y="4641.8145">Calculates latest position (lpos) for prepare</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="2816.5" y1="4688.8672" y2="4688.8672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2816.5" x2="2816.5" y1="4688.8672" y2="4701.8672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2775.5" x2="2816.5" y1="4701.8672" y2="4701.8672"/><polygon fill="#A80036" points="2785.5,4697.8672,2775.5,4701.8672,2785.5,4705.8672,2781.5,4701.8672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4684.125">66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="571" x="2803.5" y="4684.125">Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap</text><polygon fill="#A80036" points="4203,4727.1777,4213,4731.1777,4203,4735.1777,4207,4731.1777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4209" y1="4731.1777" y2="4731.1777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4726.4355">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="2803.5" y="4726.4355">Request to persist latest position for Payer</text><polygon fill="#A80036" points="4226,4756.4883,4216,4760.4883,4226,4764.4883,4222,4760.4883" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,4756.4883,4924,4760.4883,4914,4764.4883,4918,4760.4883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4220" x2="4920" y1="4760.4883" y2="4760.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4232" y="4755.7461">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="4254" y="4755.7461">Persists latest position to DB for Payer</text><polygon fill="#A80036" points="2785.5,4785.7988,2775.5,4789.7988,2785.5,4793.7988,2781.5,4789.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4214" y1="4789.7988" y2="4789.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="4785.0566">69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="4785.0566">return success</text><path d="M2679.5,4811.7988 L3233.5,4811.7988 L3233.5,4818.7988 L3223.5,4828.7988 L2679.5,4828.7988 L2679.5,4811.7988 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="4811.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="509" x="2694.5" y="4825.3672">Persist Transfer State with transferState='RESERVED' on position check pass</text><polygon fill="#A80036" points="4398.5,4846.4199,4408.5,4850.4199,4398.5,4854.4199,4402.5,4850.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4404.5" y1="4850.4199" y2="4850.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="4845.6777">70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="2803.5" y="4845.6777">Request to persist transfer</text><polygon fill="#A80036" points="4421.5,4875.7305,4411.5,4879.7305,4421.5,4883.7305,4417.5,4879.7305" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,4875.7305,4924,4879.7305,4914,4883.7305,4918,4879.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="4879.7305" y2="4879.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="4874.9883">71</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="4449.5" y="4874.9883">Persist transfer</text><polygon fill="#A80036" points="2785.5,4905.041,2775.5,4909.041,2785.5,4913.041,2781.5,4909.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4409.5" y1="4909.041" y2="4909.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="4904.2988">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="4904.2988">return success</text><path d="M2779,4929.041 L2779,5306.041 L3041,5306.041 L3041,4939.041 L3031,4929.041 L2779,4929.041 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3031,4929.041 L3031,4939.041 L3041,4939.041 L3031,4929.041 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2785" y="4946.6094">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2785" y="4961.9199">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="2801" y="4977.2305">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="2801" y="4992.541">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="2801" y="5007.8516">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2801" y="5023.1621">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="2801" y="5038.4727">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="2817" y="5053.7832">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="2817" y="5069.0938">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2801" y="5084.4043">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2801" y="5099.7148">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2817" y="5115.0254">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2833" y="5130.3359">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2833" y="5145.6465">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2833" y="5160.957">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2833" y="5176.2676">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2833" y="5191.5781">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="2833" y="5206.8887">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="2849" y="5222.1992">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2849" y="5237.5098">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2833" y="5252.8203">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2817" y="5268.1309">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2801" y="5283.4414">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2785" y="5298.752">}</text><polygon fill="#A80036" points="3374.5,5332.8047,3384.5,5336.8047,3374.5,5340.8047,3378.5,5336.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="3380.5" y1="5336.8047" y2="5336.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5332.0625">73</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2803.5" y="5332.0625">Publishes Transfer event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2283.5" x2="5004" y1="5345.8047" y2="5345.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="2288.5" y="5356.4395">[Position Handler consume batch Messages]</text><polygon fill="#A80036" points="2752.5,5377.0703,2762.5,5381.0703,2752.5,5385.0703,2756.5,5381.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2378.5" x2="2758.5" y1="5381.0703" y2="5381.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2385.5" y="5376.3281">74</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="2407.5" y="5376.3281">Consumes Position event batch of messages for Payer</text><path d="M2679.5,5396.0703 L2936.5,5396.0703 L2936.5,5403.0703 L2926.5,5413.0703 L2679.5,5413.0703 L2679.5,5396.0703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5396.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="2694.5" y="5409.6387">Persist batch Event Information</text><polygon fill="#A80036" points="4300,5430.6914,4310,5434.6914,4300,5438.6914,4304,5434.6914" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4306" y1="5434.6914" y2="5434.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5429.9492">75</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="2803.5" y="5429.9492">Request to persist event information for batch of messages</text><polygon fill="#A80036" points="4323,5460.002,4313,5464.002,4323,5468.002,4319,5464.002" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,5460.002,4924,5464.002,4914,5468.002,4918,5464.002" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="5464.002" y2="5464.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4329" y="5459.2598">76</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="4351" y="5459.2598">Persist event batch information</text><polygon fill="#A80036" points="2785.5,5489.3125,2775.5,5493.3125,2785.5,5497.3125,2781.5,5493.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4311" y1="5493.3125" y2="5493.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="5488.5703">77</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="5488.5703">return success</text><path d="M2669.5,5515.3125 L2743.5,5515.3125 L2743.5,5522.3125 L2733.5,5532.3125 L2669.5,5532.3125 L2669.5,5515.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="849.1113" style="stroke: #000000; stroke-width: 2.0;" width="2324.5" x="2669.5" y="5515.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2684.5" y="5528.8809">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="2758.5" y="5527.9473">[for each message in batch]</text><path d="M2679.5,5539.623 L2978.5,5539.623 L2978.5,5546.623 L2968.5,5556.623 L2679.5,5556.623 L2679.5,5539.623 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="277.7949" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5539.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="2694.5" y="5553.1914">Calculate position and persist change</text><polygon fill="#A80036" points="4203,5574.2441,4213,5578.2441,4203,5582.2441,4207,5578.2441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4209" y1="5578.2441" y2="5578.2441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5573.502">78</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="2803.5" y="5573.502">Request latest position from DB for Payer</text><polygon fill="#A80036" points="4226,5603.5547,4216,5607.5547,4226,5611.5547,4222,5607.5547" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,5603.5547,4924,5607.5547,4914,5611.5547,4918,5607.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4220" x2="4920" y1="5607.5547" y2="5607.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4232" y="5602.8125">79</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="4254" y="5602.8125">Retrieves latest position from DB for Payer</text><polygon fill="#A80036" points="2785.5,5632.8652,2775.5,5636.8652,2785.5,5640.8652,2781.5,5636.8652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4214" y1="5636.8652" y2="5636.8652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="5632.123">80</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="2813.5" y="5632.123">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="2816.5" y1="5666.1758" y2="5666.1758"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2816.5" x2="2816.5" y1="5666.1758" y2="5679.1758"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2775.5" x2="2816.5" y1="5679.1758" y2="5679.1758"/><polygon fill="#A80036" points="2785.5,5675.1758,2775.5,5679.1758,2785.5,5683.1758,2781.5,5679.1758" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5661.4336">81</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="2803.5" y="5661.4336">Calculates latest position (lpos) by incrementing transfer for prepare</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="2816.5" y1="5708.4863" y2="5708.4863"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2816.5" x2="2816.5" y1="5708.4863" y2="5721.4863"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2775.5" x2="2816.5" y1="5721.4863" y2="5721.4863"/><polygon fill="#A80036" points="2785.5,5717.4863,2775.5,5721.4863,2785.5,5725.4863,2781.5,5721.4863" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5703.7441">82</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="571" x="2803.5" y="5703.7441">Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap</text><polygon fill="#A80036" points="4203,5746.7969,4213,5750.7969,4203,5754.7969,4207,5750.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4209" y1="5750.7969" y2="5750.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5746.0547">83</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="2803.5" y="5746.0547">Request to persist latest position for Payer</text><polygon fill="#A80036" points="4226,5776.1074,4216,5780.1074,4226,5784.1074,4222,5780.1074" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,5776.1074,4924,5780.1074,4914,5784.1074,4918,5780.1074" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4220" x2="4920" y1="5780.1074" y2="5780.1074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4232" y="5775.3652">84</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="4254" y="5775.3652">Persists latest position to DB for Payer</text><polygon fill="#A80036" points="2785.5,5805.418,2775.5,5809.418,2785.5,5813.418,2781.5,5809.418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4214" y1="5809.418" y2="5809.418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="5804.6758">85</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="5804.6758">return success</text><path d="M2679.5,5831.418 L3233.5,5831.418 L3233.5,5838.418 L3223.5,5848.418 L2679.5,5848.418 L2679.5,5831.418 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="5831.418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="509" x="2694.5" y="5844.9863">Persist Transfer State with transferState='RESERVED' on position check pass</text><polygon fill="#A80036" points="4398.5,5866.0391,4408.5,5870.0391,4398.5,5874.0391,4402.5,5870.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4404.5" y1="5870.0391" y2="5870.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="5865.2969">86</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="2803.5" y="5865.2969">Request to persist batch transfer</text><polygon fill="#A80036" points="4421.5,5895.3496,4411.5,5899.3496,4421.5,5903.3496,4417.5,5899.3496" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,5895.3496,4924,5899.3496,4914,5903.3496,4918,5899.3496" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4415.5" x2="4920" y1="5899.3496" y2="5899.3496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4427.5" y="5894.6074">87</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="4449.5" y="5894.6074">Persist batch transfer</text><polygon fill="#A80036" points="2785.5,5924.6602,2775.5,5928.6602,2785.5,5932.6602,2781.5,5928.6602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2779.5" x2="4409.5" y1="5928.6602" y2="5928.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2791.5" y="5923.918">88</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2813.5" y="5923.918">return success</text><path d="M2779,5948.6602 L2779,6325.6602 L3041,6325.6602 L3041,5958.6602 L3031,5948.6602 L2779,5948.6602 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3031,5948.6602 L3031,5958.6602 L3041,5958.6602 L3031,5948.6602 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2785" y="5966.2285">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2785" y="5981.5391">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="2801" y="5996.8496">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="2801" y="6012.1602">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="2801" y="6027.4707">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2801" y="6042.7813">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="2801" y="6058.0918">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="2817" y="6073.4023">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="2817" y="6088.7129">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2801" y="6104.0234">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2801" y="6119.334">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2817" y="6134.6445">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2833" y="6149.9551">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2833" y="6165.2656">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2833" y="6180.5762">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2833" y="6195.8867">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2833" y="6211.1973">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="2833" y="6226.5078">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="2849" y="6241.8184">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2849" y="6257.1289">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2833" y="6272.4395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2817" y="6287.75">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2801" y="6303.0605">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2785" y="6318.3711">}</text><polygon fill="#A80036" points="3374.5,6352.4238,3384.5,6356.4238,3374.5,6360.4238,3378.5,6356.4238" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="3380.5" y1="6356.4238" y2="6356.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2781.5" y="6351.6816">89</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2803.5" y="6351.6816">Publishes Transfer event</text><path d="M2669.5,6385.4238 L2731.5,6385.4238 L2731.5,6392.4238 L2721.5,6402.4238 L2669.5,6402.4238 L2669.5,6385.4238 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2043.7363" style="stroke: #000000; stroke-width: 2.0;" width="2324.5" x="2669.5" y="6385.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="2684.5" y="6398.9922">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="2746.5" y="6398.0586">[Transfer Handler consume Single Message]</text><polygon fill="#A80036" points="3761.5,6420.0449,3771.5,6424.0449,3761.5,6428.0449,3765.5,6424.0449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3386.5" x2="3767.5" y1="6424.0449" y2="6424.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3393.5" y="6419.3027">90</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="3415.5" y="6419.3027">Consumes Transfer event</text><path d="M3687,6439.0449 L3902,6439.0449 L3902,6446.0449 L3892,6456.0449 L3687,6456.0449 L3687,6439.0449 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1297" x="3687" y="6439.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="3702" y="6452.6133">Persist Event Information</text><polygon fill="#A80036" points="4300,6473.666,4310,6477.666,4300,6481.666,4304,6477.666" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3783.5" x2="4306" y1="6477.666" y2="6477.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3790.5" y="6472.9238">91</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="3812.5" y="6472.9238">Request to persist event information</text><polygon fill="#A80036" points="4323,6502.9766,4313,6506.9766,4323,6510.9766,4319,6506.9766" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,6502.9766,4924,6506.9766,4914,6510.9766,4918,6506.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="6506.9766" y2="6506.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4329" y="6502.2344">92</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4351" y="6502.2344">Persist event information</text><polygon fill="#A80036" points="3794.5,6532.2871,3784.5,6536.2871,3794.5,6540.2871,3790.5,6536.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3788.5" x2="4311" y1="6536.2871" y2="6536.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3800.5" y="6531.5449">93</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="3822.5" y="6531.5449">return success</text><path d="M3788,6556.2871 L3788,6933.2871 L4050,6933.2871 L4050,6566.2871 L4040,6556.2871 L3788,6556.2871 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4040,6556.2871 L4040,6566.2871 L4050,6566.2871 L4040,6556.2871 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3794" y="6573.8555">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="6589.166">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="6604.4766">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="3810" y="6619.7871">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="6635.0977">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3810" y="6650.4082">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="3810" y="6665.7188">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="3826" y="6681.0293">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="3826" y="6696.3398">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="3810" y="6711.6504">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3810" y="6726.9609">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3826" y="6742.2715">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3842" y="6757.582">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3842" y="6772.8926">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3842" y="6788.2031">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3842" y="6803.5137">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3842" y="6818.8242">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="3842" y="6834.1348">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="3858" y="6849.4453">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3858" y="6864.7559">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3842" y="6880.0664">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3826" y="6895.377">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3810" y="6910.6875">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="6925.998">}</text><polygon fill="#A80036" points="4071.5,6960.0508,4081.5,6964.0508,4071.5,6968.0508,4075.5,6964.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3783.5" x2="4077.5" y1="6964.0508" y2="6964.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3790.5" y="6959.3086">94</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="3812.5" y="6959.3086">Publishes Notifications event for Payer</text><path d="M3788,6977.0508 L3788,7354.0508 L4050,7354.0508 L4050,6987.0508 L4040,6977.0508 L3788,6977.0508 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4040,6977.0508 L4040,6987.0508 L4050,6987.0508 L4040,6977.0508 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3794" y="6994.6191">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="7009.9297">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="7025.2402">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="3810" y="7040.5508">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="3810" y="7055.8613">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3810" y="7071.1719">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="3810" y="7086.4824">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="3826" y="7101.793">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="3826" y="7117.1035">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="3810" y="7132.4141">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3810" y="7147.7246">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3826" y="7163.0352">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3842" y="7178.3457">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3842" y="7193.6563">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3842" y="7208.9668">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3842" y="7224.2773">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3842" y="7239.5879">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="3842" y="7254.8984">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="3858" y="7270.209">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3858" y="7285.5195">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3842" y="7300.8301">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3826" y="7316.1406">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3810" y="7331.4512">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="7346.7617">}</text><polygon fill="#A80036" points="4071.5,7380.8145,4081.5,7384.8145,4071.5,7388.8145,4075.5,7384.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3783.5" x2="4077.5" y1="7384.8145" y2="7384.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3790.5" y="7380.0723">95</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="3812.5" y="7380.0723">Publishes Notifications event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2669.5" x2="4994" y1="7393.8145" y2="7393.8145"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="2674.5" y="7404.4492">[Transfer Handler consume batch Messages]</text><polygon fill="#A80036" points="3761.5,7425.0801,3771.5,7429.0801,3761.5,7433.0801,3765.5,7429.0801" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3386.5" x2="3767.5" y1="7429.0801" y2="7429.0801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3393.5" y="7424.3379">96</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="3415.5" y="7424.3379">Consumes Transfer event batch of messages for Payer</text><path d="M2679.5,7444.0801 L2936.5,7444.0801 L2936.5,7451.0801 L2926.5,7461.0801 L2679.5,7461.0801 L2679.5,7444.0801 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="2304.5" x="2679.5" y="7444.0801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="2694.5" y="7457.6484">Persist batch Event Information</text><polygon fill="#A80036" points="4300,7478.7012,4310,7482.7012,4300,7486.7012,4304,7482.7012" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2769.5" x2="4306" y1="7482.7012" y2="7482.7012"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2776.5" y="7477.959">97</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="2798.5" y="7477.959">Request to persist event information for batch of messages</text><polygon fill="#A80036" points="4323,7508.0117,4313,7512.0117,4323,7516.0117,4319,7512.0117" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,7508.0117,4924,7512.0117,4914,7516.0117,4918,7512.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="7512.0117" y2="7512.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4329" y="7507.2695">98</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="4351" y="7507.2695">Persist event batch information</text><polygon fill="#A80036" points="2780.5,7537.3223,2770.5,7541.3223,2780.5,7545.3223,2776.5,7541.3223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2774.5" x2="4311" y1="7541.3223" y2="7541.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2786.5" y="7536.5801">99</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2808.5" y="7536.5801">return success</text><path d="M3687,7563.3223 L3761,7563.3223 L3761,7570.3223 L3751,7580.3223 L3687,7580.3223 L3687,7563.3223 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="858.8379" style="stroke: #000000; stroke-width: 2.0;" width="480" x="3687" y="7563.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="3702" y="7576.8906">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="3776" y="7575.957">[for each message in batch]</text><path d="M3788,7585.6328 L3788,7962.6328 L4050,7962.6328 L4050,7595.6328 L4040,7585.6328 L3788,7585.6328 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4040,7585.6328 L4040,7595.6328 L4050,7595.6328 L4040,7585.6328 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3794" y="7603.2012">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="7618.5117">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="7633.8223">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="3810" y="7649.1328">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="7664.4434">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3810" y="7679.7539">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="3810" y="7695.0645">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="3826" y="7710.375">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="3826" y="7725.6855">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="3810" y="7740.9961">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3810" y="7756.3066">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3826" y="7771.6172">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3842" y="7786.9277">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3842" y="7802.2383">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3842" y="7817.5488">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3842" y="7832.8594">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3842" y="7848.1699">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="3842" y="7863.4805">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="3858" y="7878.791">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3858" y="7894.1016">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3842" y="7909.4121">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3826" y="7924.7227">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3810" y="7940.0332">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="7955.3438">}</text><polygon fill="#A80036" points="4071.5,7989.3965,4081.5,7993.3965,4071.5,7997.3965,4075.5,7993.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3783.5" x2="4077.5" y1="7993.3965" y2="7993.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="3790.5" y="7988.6543">100</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="3821.5" y="7988.6543">Publishes Notifications event for Payer</text><path d="M3788,8006.3965 L3788,8383.3965 L4050,8383.3965 L4050,8016.3965 L4040,8006.3965 L3788,8006.3965 " fill="#FFFF00" filter="url(#fmbu4mzqrrsr6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4040,8006.3965 L4040,8016.3965 L4050,8016.3965 L4040,8006.3965 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3794" y="8023.9648">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="8039.2754">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="3810" y="8054.5859">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="3810" y="8069.8965">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="3810" y="8085.207">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3810" y="8100.5176">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="3810" y="8115.8281">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="3826" y="8131.1387">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="3826" y="8146.4492">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="3810" y="8161.7598">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3810" y="8177.0703">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3826" y="8192.3809">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3842" y="8207.6914">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3842" y="8223.002">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3842" y="8238.3125">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3842" y="8253.623">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3842" y="8268.9336">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="3842" y="8284.2441">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="3858" y="8299.5547">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3858" y="8314.8652">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3842" y="8330.1758">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3826" y="8345.4863">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3810" y="8360.7969">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3794" y="8376.1074">}</text><polygon fill="#A80036" points="4071.5,8410.1602,4081.5,8414.1602,4071.5,8418.1602,4075.5,8414.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3783.5" x2="4077.5" y1="8414.1602" y2="8414.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="3790.5" y="8409.418">101</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="3821.5" y="8409.418">Publishes Notifications event for Payee</text><path d="M23,8443.1602 L246,8443.1602 L246,8450.1602 L236,8460.1602 L23,8460.1602 L23,8443.1602 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="860.9609" style="stroke: #000000; stroke-width: 2.0;" width="4981" x="23" y="8443.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="38" y="8456.7285">Send notification for Payer</text><path d="M33,8467.4707 L95,8467.4707 L95,8474.4707 L85,8484.4707 L33,8484.4707 L33,8467.4707 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="829.6504" style="stroke: #000000; stroke-width: 2.0;" width="4961" x="33" y="8467.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="8481.0391">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="271" x="110" y="8480.1055">[Notifications Handler consume Single Message]</text><polygon fill="#A80036" points="784.5,8502.0918,774.5,8506.0918,784.5,8510.0918,780.5,8506.0918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="4082.5" y1="8506.0918" y2="8506.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="8501.3496">102</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="821.5" y="8501.3496">Consumes Notifications event</text><path d="M642,8521.0918 L857,8521.0918 L857,8528.0918 L847,8538.0918 L642,8538.0918 L642,8521.0918 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="8521.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="657" y="8534.6602">Persist Event Information</text><polygon fill="#A80036" points="1290.5,8555.7129,1300.5,8559.7129,1290.5,8563.7129,1294.5,8559.7129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1296.5" y1="8559.7129" y2="8559.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="780.5" y="8554.9707">103</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="811.5" y="8554.9707">Requests to persist event information - POST - HTTP://events/</text><polygon fill="#A80036" points="4300,8585.0234,4310,8589.0234,4300,8593.0234,4304,8589.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4306" y1="8589.0234" y2="8589.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="8584.2813">104</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1340.5" y="8584.2813">Request to persist event information</text><polygon fill="#A80036" points="4323,8614.334,4313,8618.334,4323,8622.334,4319,8618.334" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,8614.334,4924,8618.334,4914,8622.334,4918,8618.334" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="8618.334" y2="8618.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4329" y="8613.5918">105</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4360" y="8613.5918">Persist event information</text><polygon fill="#A80036" points="1313.5,8643.6445,1303.5,8647.6445,1313.5,8651.6445,1309.5,8647.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4311" y1="8647.6445" y2="8647.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="8642.9023">106</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1350.5" y="8642.9023">return success</text><polygon fill="#A80036" points="784.5,8672.9551,774.5,8676.9551,784.5,8680.9551,780.5,8676.9551" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="1301.5" y1="8676.9551" y2="8676.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="8672.2129">107</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="821.5" y="8672.2129">return success</text><polygon fill="#A80036" points="1290.5,8709.2656,1300.5,8713.2656,1290.5,8717.2656,1294.5,8713.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1296.5" y1="8713.2656" y2="8713.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="780.5" y="8708.5234">108</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="811.5" y="8708.5234">Requests Notification details for Payer - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="4518,8738.5762,4528,8742.5762,4518,8746.5762,4522,8742.5762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4524" y1="8742.5762" y2="8742.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="8737.834">109</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1340.5" y="8737.834">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="4541,8767.8867,4531,8771.8867,4541,8775.8867,4537,8771.8867" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,8767.8867,4924,8771.8867,4914,8775.8867,4918,8771.8867" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4535" x2="4920" y1="8771.8867" y2="8771.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4547" y="8767.1445">110</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="4578" y="8767.1445">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="1313.5,8797.1973,1303.5,8801.1973,1313.5,8805.1973,1309.5,8801.1973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4529" y1="8801.1973" y2="8801.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="8796.4551">111</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1350.5" y="8796.4551">Returns Notifications details for Payer</text><polygon fill="#A80036" points="784.5,8826.5078,774.5,8830.5078,784.5,8834.5078,780.5,8830.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="1301.5" y1="8830.5078" y2="8830.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="8825.7656">112</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="821.5" y="8825.7656">Returns Notifications details for Payer</text><polygon fill="#A80036" points="85.5,8855.8184,75.5,8859.8184,85.5,8863.8184,81.5,8859.8184" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="79.5" x2="762.5" y1="8859.8184" y2="8859.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="91.5" y="8855.0762">113</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="122.5" y="8855.0762">HTTP Callback with Prepare result to Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="4994" y1="8868.8184" y2="8868.8184"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="38" y="8879.4531">[Notifications Handler consume batch Messages]</text><polygon fill="#A80036" points="784.5,8900.084,774.5,8904.084,784.5,8908.084,780.5,8904.084" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="4082.5" y1="8904.084" y2="8904.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="8899.3418">114</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="821.5" y="8899.3418">Consumes Notifications event batch of messages for Payer</text><path d="M642,8919.084 L899,8919.084 L899,8926.084 L889,8936.084 L642,8936.084 L642,8919.084 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="8919.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="657" y="8932.6523">Persist batch Event Information</text><polygon fill="#A80036" points="1290.5,8953.7051,1300.5,8957.7051,1290.5,8961.7051,1294.5,8957.7051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1296.5" y1="8957.7051" y2="8957.7051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="780.5" y="8952.9629">115</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="811.5" y="8952.9629">Requests to persist batch event information - POST - HTTP://events/</text><polygon fill="#A80036" points="4300,8983.0156,4310,8987.0156,4300,8991.0156,4304,8987.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4306" y1="8987.0156" y2="8987.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="8982.2734">116</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1340.5" y="8982.2734">Request to persist batch event information</text><polygon fill="#A80036" points="4323,9012.3262,4313,9016.3262,4323,9020.3262,4319,9016.3262" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,9012.3262,4924,9016.3262,4914,9020.3262,4918,9016.3262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="9016.3262" y2="9016.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4329" y="9011.584">117</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4360" y="9011.584">Persist event information</text><polygon fill="#A80036" points="1313.5,9041.6367,1303.5,9045.6367,1313.5,9049.6367,1309.5,9045.6367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4311" y1="9045.6367" y2="9045.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="9040.8945">118</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1350.5" y="9040.8945">return success</text><polygon fill="#A80036" points="784.5,9070.9473,774.5,9074.9473,784.5,9078.9473,780.5,9074.9473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="1301.5" y1="9074.9473" y2="9074.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="9070.2051">119</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="821.5" y="9070.2051">return success</text><path d="M43,9096.9473 L117,9096.9473 L117,9103.9473 L107,9113.9473 L43,9113.9473 L43,9096.9473 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="193.1738" style="stroke: #000000; stroke-width: 2.0;" width="4941" x="43" y="9096.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="58" y="9110.5156">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="132" y="9109.582">[for each message in batch]</text><polygon fill="#A80036" points="1290.5,9131.5684,1300.5,9135.5684,1290.5,9139.5684,1294.5,9135.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1296.5" y1="9135.5684" y2="9135.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="780.5" y="9130.8262">120</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="811.5" y="9130.8262">Requests Notification details for Payer - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="4518,9160.8789,4528,9164.8789,4518,9168.8789,4522,9164.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4524" y1="9164.8789" y2="9164.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="9160.1367">121</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1340.5" y="9160.1367">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="4541,9190.1895,4531,9194.1895,4541,9198.1895,4537,9194.1895" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,9190.1895,4924,9194.1895,4914,9198.1895,4918,9194.1895" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4535" x2="4920" y1="9194.1895" y2="9194.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4547" y="9189.4473">122</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="4578" y="9189.4473">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="1313.5,9219.5,1303.5,9223.5,1313.5,9227.5,1309.5,9223.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4529" y1="9223.5" y2="9223.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="9218.7578">123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1350.5" y="9218.7578">Returns Notifications details for Payer</text><polygon fill="#A80036" points="784.5,9248.8105,774.5,9252.8105,784.5,9256.8105,780.5,9252.8105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778.5" x2="1301.5" y1="9252.8105" y2="9252.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="790.5" y="9248.0684">124</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="821.5" y="9248.0684">Returns Notifications details for Payer</text><polygon fill="#A80036" points="85.5,9278.1211,75.5,9282.1211,85.5,9286.1211,81.5,9282.1211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="79.5" x2="762.5" y1="9282.1211" y2="9282.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="91.5" y="9277.3789">125</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="122.5" y="9277.3789">HTTP Callback with Prepare result to Payer</text><path d="M23,9318.1211 L248,9318.1211 L248,9325.1211 L238,9335.1211 L23,9335.1211 L23,9318.1211 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="860.9609" style="stroke: #000000; stroke-width: 2.0;" width="4981" x="23" y="9318.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="38" y="9331.6895">Send notification for Payee</text><path d="M33,9342.4316 L95,9342.4316 L95,9349.4316 L85,9359.4316 L33,9359.4316 L33,9342.4316 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="829.6504" style="stroke: #000000; stroke-width: 2.0;" width="4961" x="33" y="9342.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="9356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="271" x="110" y="9355.0664">[Notifications Handler consume Single Message]</text><polygon fill="#A80036" points="779.5,9377.0527,769.5,9381.0527,779.5,9385.0527,775.5,9381.0527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="4082.5" y1="9381.0527" y2="9381.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="9376.3105">126</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="816.5" y="9376.3105">Consumes Notifications event</text><path d="M642,9396.0527 L857,9396.0527 L857,9403.0527 L847,9413.0527 L642,9413.0527 L642,9396.0527 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="9396.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="657" y="9409.6211">Persist Event Information</text><polygon fill="#A80036" points="1290.5,9430.6738,1300.5,9434.6738,1290.5,9438.6738,1294.5,9434.6738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768.5" x2="1296.5" y1="9434.6738" y2="9434.6738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="775.5" y="9429.9316">127</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="806.5" y="9429.9316">Requests to persist event information - POST - HTTP://events/</text><polygon fill="#A80036" points="4300,9459.9844,4310,9463.9844,4300,9467.9844,4304,9463.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4306" y1="9463.9844" y2="9463.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="9459.2422">128</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1340.5" y="9459.2422">Request to persist event information</text><polygon fill="#A80036" points="4323,9489.2949,4313,9493.2949,4323,9497.2949,4319,9493.2949" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,9489.2949,4924,9493.2949,4914,9497.2949,4918,9493.2949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="9493.2949" y2="9493.2949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4329" y="9488.5527">129</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4360" y="9488.5527">Persist event information</text><polygon fill="#A80036" points="1313.5,9518.6055,1303.5,9522.6055,1313.5,9526.6055,1309.5,9522.6055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4311" y1="9522.6055" y2="9522.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="9517.8633">130</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1350.5" y="9517.8633">return success</text><polygon fill="#A80036" points="779.5,9547.916,769.5,9551.916,779.5,9555.916,775.5,9551.916" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1301.5" y1="9551.916" y2="9551.916"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="9547.1738">131</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="816.5" y="9547.1738">return success</text><polygon fill="#A80036" points="1290.5,9584.2266,1300.5,9588.2266,1290.5,9592.2266,1294.5,9588.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768.5" x2="1296.5" y1="9588.2266" y2="9588.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="775.5" y="9583.4844">132</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="806.5" y="9583.4844">Requests Notification details for Payee - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="4518,9613.5371,4528,9617.5371,4518,9621.5371,4522,9617.5371" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4524" y1="9617.5371" y2="9617.5371"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="9612.7949">133</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="1340.5" y="9612.7949">Fetches Notifications details for Payee</text><polygon fill="#A80036" points="4541,9642.8477,4531,9646.8477,4541,9650.8477,4537,9646.8477" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,9642.8477,4924,9646.8477,4914,9650.8477,4918,9646.8477" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4535" x2="4920" y1="9646.8477" y2="9646.8477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4547" y="9642.1055">134</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="4578" y="9642.1055">Fetches Notifications details for Payee</text><polygon fill="#A80036" points="1313.5,9672.1582,1303.5,9676.1582,1313.5,9680.1582,1309.5,9676.1582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4529" y1="9676.1582" y2="9676.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="9671.416">135</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="1350.5" y="9671.416">Returns Notifications details for Payee</text><polygon fill="#A80036" points="779.5,9701.4688,769.5,9705.4688,779.5,9709.4688,775.5,9705.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1301.5" y1="9705.4688" y2="9705.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="9700.7266">136</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="816.5" y="9700.7266">Returns Notifications details for Payee</text><polygon fill="#A80036" points="85.5,9730.7793,75.5,9734.7793,85.5,9738.7793,81.5,9734.7793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="79.5" x2="767.5" y1="9734.7793" y2="9734.7793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="91.5" y="9730.0371">137</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="122.5" y="9730.0371">HTTP Callback with Prepare result to Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="4994" y1="9743.7793" y2="9743.7793"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="38" y="9754.4141">[Notifications Handler consume batch Messages]</text><polygon fill="#A80036" points="779.5,9775.0449,769.5,9779.0449,779.5,9783.0449,775.5,9779.0449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="4082.5" y1="9779.0449" y2="9779.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="9774.3027">138</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="816.5" y="9774.3027">Consumes Notifications event batch of messages for Payee</text><path d="M642,9794.0449 L899,9794.0449 L899,9801.0449 L889,9811.0449 L642,9811.0449 L642,9794.0449 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="4342" x="642" y="9794.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="657" y="9807.6133">Persist batch Event Information</text><polygon fill="#A80036" points="1290.5,9828.666,1300.5,9832.666,1290.5,9836.666,1294.5,9832.666" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768.5" x2="1296.5" y1="9832.666" y2="9832.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="775.5" y="9827.9238">139</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="806.5" y="9827.9238">Requests to persist batch event information - POST - HTTP://events/</text><polygon fill="#A80036" points="4300,9857.9766,4310,9861.9766,4300,9865.9766,4304,9861.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4306" y1="9861.9766" y2="9861.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="9857.2344">140</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1340.5" y="9857.2344">Request to persist batch event information</text><polygon fill="#A80036" points="4323,9887.2871,4313,9891.2871,4323,9895.2871,4319,9891.2871" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,9887.2871,4924,9891.2871,4914,9895.2871,4918,9891.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4317" x2="4920" y1="9891.2871" y2="9891.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4329" y="9886.5449">141</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="4360" y="9886.5449">Persist event information</text><polygon fill="#A80036" points="1313.5,9916.5977,1303.5,9920.5977,1313.5,9924.5977,1309.5,9920.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4311" y1="9920.5977" y2="9920.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="9915.8555">142</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1350.5" y="9915.8555">return success</text><polygon fill="#A80036" points="779.5,9945.9082,769.5,9949.9082,779.5,9953.9082,775.5,9949.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1301.5" y1="9949.9082" y2="9949.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="9945.166">143</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="816.5" y="9945.166">return success</text><path d="M43,9971.9082 L117,9971.9082 L117,9978.9082 L107,9988.9082 L43,9988.9082 L43,9971.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="193.1738" style="stroke: #000000; stroke-width: 2.0;" width="4941" x="43" y="9971.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="58" y="9985.4766">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="132" y="9984.543">[for each message in batch]</text><polygon fill="#A80036" points="1290.5,10006.5293,1300.5,10010.5293,1290.5,10014.5293,1294.5,10010.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768.5" x2="1296.5" y1="10010.5293" y2="10010.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="775.5" y="10005.7871">144</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="806.5" y="10005.7871">Requests Notification details for Payee - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="4518,10035.8398,4528,10039.8398,4518,10043.8398,4522,10039.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1302.5" x2="4524" y1="10039.8398" y2="10039.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1309.5" y="10035.0977">145</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="1340.5" y="10035.0977">Fetches Notifications details for Payee</text><polygon fill="#A80036" points="4541,10065.1504,4531,10069.1504,4541,10073.1504,4537,10069.1504" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4914,10065.1504,4924,10069.1504,4914,10073.1504,4918,10069.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4535" x2="4920" y1="10069.1504" y2="10069.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="4547" y="10064.4082">146</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="4578" y="10064.4082">Fetches Notifications details for Payee</text><polygon fill="#A80036" points="1313.5,10094.4609,1303.5,10098.4609,1313.5,10102.4609,1309.5,10098.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307.5" x2="4529" y1="10098.4609" y2="10098.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="1319.5" y="10093.7188">147</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="1350.5" y="10093.7188">Returns Notifications details for Payee</text><polygon fill="#A80036" points="779.5,10123.7715,769.5,10127.7715,779.5,10131.7715,775.5,10127.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773.5" x2="1301.5" y1="10127.7715" y2="10127.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="785.5" y="10123.0293">148</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="816.5" y="10123.0293">Returns Notifications details for Payee</text><polygon fill="#A80036" points="85.5,10153.082,75.5,10157.082,85.5,10161.082,81.5,10157.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="79.5" x2="767.5" y1="10157.082" y2="10157.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="91.5" y="10152.3398">149</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="122.5" y="10152.3398">HTTP Callback with Prepare result to Payee</text><!--
@startuml
title 1.1 DFSP1 sends a Prepare Transfer request to DFSP2

autonumber


actor "Payer" as DFSP1
actor "Payee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

group DFSP1 sends a Prepare Transfer request to Payee
    activate MLAPI
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp1,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - http://transfers
    MLAPI -> MLAPI: validates incoming token, and the originator matches Payer
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for Payer
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI

    activate PREP_HANDLER
    alt Prepare Handler consume Single Message
        TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for Payer
        group Persist Event Information
            PREP_HANDLER -> EVENT_DAO: Request to persist event information
            EVENT_DAO <-> DB: Persist event information
            EVENT_DAO -> PREP_HANDLER: return success
        end

        group Validate Prepare Transfer
            group Validate Payer
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
                PARTICIPANT_DAO <-> DB: return Participant details if it exists
                PARTICIPANT_DAO -> PREP_HANDLER: return Participant details if it exists
                PREP_HANDLER <-> PREP_HANDLER: Validates Payer
            end
            group Validate Payee
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
                PARTICIPANT_DAO <-> DB: return Participant details if it exists
                PARTICIPANT_DAO -> PREP_HANDLER: return Participant details if it exists
                PREP_HANDLER <-> PREP_HANDLER: Validates Payee
            end
            group Duplicate check
                PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
                TRANS_DAO <-> DB: return Transfer if it exists
                TRANS_DAO -> PREP_HANDLER: return Transfer if it exists
                PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check
            end
            PREP_HANDLER <-> PREP_HANDLER: Validates amount
            PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition
            PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement)
        end

        group Persist Transfer State with transferState='RECEIVED' on validation pass
            PREP_HANDLER -> TRANS_DAO: Request to persist transfer
            TRANS_DAO <-> DB: Persist transfer
            TRANS_DAO -> PREP_HANDLER: return success
        end

        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for Payer
    else Prepare Handler consume batch Messages
        TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event batch of messages for Payer
        group Persist batch Event Information
            PREP_HANDLER -> EVENT_DAO: Request to persist event information for batch of messages
            EVENT_DAO <-> DB: Persist event batch information
            EVENT_DAO -> PREP_HANDLER: return success
        end

        group Fetch batch Payer information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payer Participant details (if it exists)
            PARTICIPANT_DAO <-> DB: return Participant details if it exists
            PARTICIPANT_DAO -> PREP_HANDLER: return Participant details if it exists
            PREP_HANDLER <-> PREP_HANDLER: Validates Payer
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER
        end

        group Fetch batch Payee information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payee Participant details (if it exists)
            PARTICIPANT_DAO <-> DB: return Participant details if it exists
            PARTICIPANT_DAO -> PREP_HANDLER: return Participant details if it exists
            PREP_HANDLER <-> PREP_HANDLER: Validates Payee
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE
        end

        group Fetch batch of transfers
            PREP_HANDLER -> TRANS_DAO: Request to retrieve batch of Transfers (if it exists)
            TRANS_DAO <-> DB: return batch of Transfers (if it exists)
            TRANS_DAO -> PREP_HANDLER: return batch of Transfer (if it exists)
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_TRANSFERS
        end

        loop for each message in batch

            group Validate Prepare Transfer
                group Validate Payer
                    PREP_HANDLER <-> PREP_HANDLER: Validates Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER
                end
                group Validate Payee
                    PREP_HANDLER <-> PREP_HANDLER: Validates Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE
                end
                group Duplicate check
                    PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check against in-memory var $LIST_TRANSFERS
                end
                PREP_HANDLER <-> PREP_HANDLER: Validates amount
                PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition
                PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement)
            end

            group Persist Transfer State with transferState='RECEIVED' on validation pass
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer
                TRANS_DAO <-> DB: Persist transfer
                TRANS_DAO -> PREP_HANDLER: return success
            end

            note right of PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for Payer
        end
    end
    deactivate PREP_HANDLER

    activate POS_HANDLER
    alt Position Handler consume Single Message
        TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for Payer

        group Persist Event Information
            POS_HANDLER -> EVENT_DAO: Request to persist event information
            EVENT_DAO <-> DB: Persist event information
            EVENT_DAO -> POS_HANDLER: return success
        end

        group Calculate position and persist change
            POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
            POS_DAO <-> DB: Retrieves latest position from DB for Payer
            POS_DAO -> POS_HANDLER: Return latest position

            POS_HANDLER <-> POS_HANDLER: Calculates latest position (lpos) for prepare
            POS_HANDLER <-> POS_HANDLER: Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos < netcap
            
            POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
            POS_DAO <-> DB: Persists latest position to DB for Payer
            POS_DAO -> POS_HANDLER: return success
        end

        group Persist Transfer State with transferState='RESERVED' on position check pass
            POS_HANDLER -> TRANS_DAO: Request to persist transfer
            TRANS_DAO <-> DB: Persist transfer
            TRANS_DAO -> POS_HANDLER: return success
        end

        note right of POS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: transfer,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    else Position Handler consume batch Messages
        TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event batch of messages for Payer

        group Persist batch Event Information
            POS_HANDLER -> EVENT_DAO: Request to persist event information for batch of messages
            EVENT_DAO <-> DB: Persist event batch information
            EVENT_DAO -> POS_HANDLER: return success
        end

        loop for each message in batch
            group Calculate position and persist change
                POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
                POS_DAO <-> DB: Retrieves latest position from DB for Payer
                POS_DAO -> POS_HANDLER: Return latest position

                POS_HANDLER <-> POS_HANDLER: Calculates latest position (lpos) by incrementing transfer for prepare
                POS_HANDLER <-> POS_HANDLER: Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos < netcap
                
                POS_HANDLER -> POS_DAO: Request to persist latest position for Payer
                POS_DAO <-> DB: Persists latest position to DB for Payer
                POS_DAO -> POS_HANDLER: return success
            end
            group Persist Transfer State with transferState='RESERVED' on position check pass
                POS_HANDLER -> TRANS_DAO: Request to persist batch transfer
                TRANS_DAO <-> DB: Persist batch transfer
                TRANS_DAO -> POS_HANDLER: return success
            end
            note right of POS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: transfer,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
        end
    end
    deactivate POS_HANDLER

    activate TRANS_HANDLER
    alt Transfer Handler consume Single Message
        TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event

        group Persist Event Information
            TRANS_HANDLER -> EVENT_DAO: Request to persist event information
            EVENT_DAO <-> DB: Persist event information
            EVENT_DAO -> TRANS_HANDLER: return success
        end

        
        note right of TRANS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for Payer
        note right of TRANS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for Payee
    else Transfer Handler consume batch Messages
        TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event batch of messages for Payer

        group Persist batch Event Information
            POS_HANDLER -> EVENT_DAO: Request to persist event information for batch of messages
            EVENT_DAO <-> DB: Persist event batch information
            EVENT_DAO -> POS_HANDLER: return success
        end


        loop for each message in batch
            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for Payer
            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for Payee
        end
    end
    deactivate TRANS_HANDLER

    group Send notification for Payer
        activate NOTIFY_HANDLER
        alt Notifications Handler consume Single Message
            TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
            group Persist Event Information
                NOTIFY_HANDLER -> CSAPI: Requests to persist event information - POST - HTTP://events/
                CSAPI -> EVENT_DAO: Request to persist event information
                EVENT_DAO <-> DB: Persist event information
                EVENT_DAO -> CSAPI: return success
                CSAPI -> NOTIFY_HANDLER: return success
            end
            NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payer - GET - HTTP://notifications/DFPS1
            CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payer
            NOTIFY_DAO <-> DB: Fetches Notifications details for Payer
            NOTIFY_DAO -> CSAPI: Returns Notifications details for Payer
            CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payer
            NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payer
        else Notifications Handler consume batch Messages
            TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event batch of messages for Payer
            group Persist batch Event Information
                NOTIFY_HANDLER -> CSAPI: Requests to persist batch event information - POST - HTTP://events/
                CSAPI -> EVENT_DAO: Request to persist batch event information
                EVENT_DAO <-> DB: Persist event information
                EVENT_DAO -> CSAPI: return success
                CSAPI -> NOTIFY_HANDLER: return success
            end
            loop for each message in batch
                NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payer - GET - HTTP://notifications/DFPS1
                CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payer
                NOTIFY_DAO <-> DB: Fetches Notifications details for Payer
                NOTIFY_DAO -> CSAPI: Returns Notifications details for Payer
                CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payer
                NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payer
            end
        end
        deactivate NOTIFY_HANDLER
    end

    group Send notification for Payee
        activate NOTIFY_HANDLER
        alt Notifications Handler consume Single Message
            TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
            group Persist Event Information
                NOTIFY_HANDLER -> CSAPI: Requests to persist event information - POST - HTTP://events/
                CSAPI -> EVENT_DAO: Request to persist event information
                EVENT_DAO <-> DB: Persist event information
                EVENT_DAO -> CSAPI: return success
                CSAPI -> NOTIFY_HANDLER: return success
            end
            NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payee - GET - HTTP://notifications/DFPS1
            CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payee
            NOTIFY_DAO <-> DB: Fetches Notifications details for Payee
            NOTIFY_DAO -> CSAPI: Returns Notifications details for Payee
            CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payee
            NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payee
        else Notifications Handler consume batch Messages
            TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event batch of messages for Payee
            group Persist batch Event Information
                NOTIFY_HANDLER -> CSAPI: Requests to persist batch event information - POST - HTTP://events/
                CSAPI -> EVENT_DAO: Request to persist batch event information
                EVENT_DAO <-> DB: Persist event information
                EVENT_DAO -> CSAPI: return success
                CSAPI -> NOTIFY_HANDLER: return success
            end
            loop for each message in batch
                NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payee - GET - HTTP://notifications/DFPS1
                CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payee
                NOTIFY_DAO <-> DB: Fetches Notifications details for Payee
                NOTIFY_DAO -> CSAPI: Returns Notifications details for Payee
                CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payee
                NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payee
            end
        end
        deactivate NOTIFY_HANDLER
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>