<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2763px" preserveAspectRatio="none" style="width:3074px;height:2763px;" version="1.1" viewBox="0 0 3074 2763" width="3074px" zoomAndPan="magnify"><defs><filter height="300%" id="f1dfsqbkfkhv4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="591" x="1242.75" y="23.5352">1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#D3D3D3" height="2718.1738" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2718.1738" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2718.1738" style="stroke: #A80036; stroke-width: 1.0;" width="1922.5" x="981" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1891.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="1096.5645" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="271.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2362.3789"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="1118.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1592" y="1243.8516"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="2494.8867" style="stroke: #000000; stroke-width: 2.0;" width="3040.5" x="23" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="271.1738" style="stroke: #000000; stroke-width: 2.0;" width="707" x="1508" y="1330.4727"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1545.5" x="1508" y="1615.6465"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="264.7949" style="stroke: #000000; stroke-width: 2.0;" width="2876.5" x="33" y="2377.3789"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1052" x2="1052" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1213" x2="1213" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1597" x2="1597" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2214.5" x2="2214.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2353.5" x2="2353.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2457.5" x2="2457.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2566.5" x2="2566.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2851.5" x2="2851.5" y1="137.2871" y2="2666.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2992.5" x2="2992.5" y1="137.2871" y2="2666.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2678.709">DFSP1</text><ellipse cx="67.5" cy="2691.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2699.6621 L67.5,2726.6621 M54.5,2707.6621 L80.5,2707.6621 M67.5,2726.6621 L54.5,2741.6621 M67.5,2726.6621 L80.5,2741.6621 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2678.709">DFSP2</text><ellipse cx="126.5" cy="2691.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2699.6621 L126.5,2726.6621 M113.5,2707.6621 L139.5,2707.6621 M126.5,2726.6621 L113.5,2741.6621 M126.5,2726.6621 L139.5,2741.6621 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2678.709">ML API Adapter</text><path d="M325,2685.6621 L325,2709.6621 M325,2697.6621 L342,2697.6621 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="2678.709">ML API Notification Event Handler</text><ellipse cx="527" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,2685.6621,529,2680.6621,527,2685.6621,529,2690.6621,523,2685.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="985" y="134.334">Central Service API</text><path d="M1031.5,92.7988 L1031.5,116.7988 M1031.5,104.7988 L1048.5,104.7988 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1060.5" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="985" y="2678.709">Central Service API</text><path d="M1031.5,2685.6621 L1031.5,2709.6621 M1031.5,2697.6621 L1048.5,2697.6621 " fill="none" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1060.5" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1133" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1129" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1136" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1133" y="2665.1738"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1129" y="2669.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1136" y="2689.709">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1518" y="134.334">Prepare Event Handler</text><ellipse cx="1597" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1593,92.7988,1599,87.7988,1597,92.7988,1599,97.7988,1593,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1518" y="2678.709">Prepare Event Handler</text><ellipse cx="1597" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1593,2685.6621,1599,2680.6621,1597,2685.6621,1599,2690.6621,1593,2685.6621" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2145.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2141.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2148.5" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2145.5" y="2665.1738"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2141.5" y="2669.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2148.5" y="2689.709">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="2302.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="2298.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="2305.5" y="122.334">Errors-Topic</text><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="2302.5" y="2665.1738"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="2298.5" y="2669.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="2305.5" y="2689.709">Errors-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2418.5" y="134.334">Event DAO</text><ellipse cx="2457.5" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2445.5" x2="2469.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2418.5" y="2678.709">Event DAO</text><ellipse cx="2457.5" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2445.5" x2="2469.5" y1="2711.6621" y2="2711.6621"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2506.5" y="134.334">Notification DAO</text><ellipse cx="2566.5" cy="104.7988" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2554.5" x2="2578.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2506.5" y="2678.709">Notification DAO</text><ellipse cx="2566.5" cy="2697.6621" fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2554.5" x2="2578.5" y1="2711.6621" y2="2711.6621"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2803.5" y="134.334">Central Store</text><path d="M2833.5,84.7988 C2833.5,74.7988 2851.5,74.7988 2851.5,74.7988 C2851.5,74.7988 2869.5,74.7988 2869.5,84.7988 L2869.5,110.7988 C2869.5,120.7988 2851.5,120.7988 2851.5,120.7988 C2851.5,120.7988 2833.5,120.7988 2833.5,110.7988 L2833.5,84.7988 " fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2833.5,84.7988 C2833.5,94.7988 2851.5,94.7988 2851.5,94.7988 C2851.5,94.7988 2869.5,94.7988 2869.5,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2803.5" y="2678.709">Central Store</text><path d="M2833.5,2691.6621 C2833.5,2681.6621 2851.5,2681.6621 2851.5,2681.6621 C2851.5,2681.6621 2869.5,2681.6621 2869.5,2691.6621 L2869.5,2717.6621 C2869.5,2727.6621 2851.5,2727.6621 2851.5,2727.6621 C2851.5,2727.6621 2833.5,2727.6621 2833.5,2717.6621 L2833.5,2691.6621 " fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2833.5,2691.6621 C2833.5,2701.6621 2851.5,2701.6621 2851.5,2701.6621 C2851.5,2701.6621 2869.5,2701.6621 2869.5,2691.6621 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="2941.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="2948.5" y="122.334">TRANS_DAO</text><rect fill="#FEFECE" filter="url(#f1dfsqbkfkhv4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="2941.5" y="2665.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="2948.5" y="2685.709">TRANS_DAO</text><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="1096.5645" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="271.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2362.3789"/><rect fill="#FFFFFF" filter="url(#f1dfsqbkfkhv4)" height="1118.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1592" y="1243.8516"/><path d="M23,154.2871 L243,154.2871 L243,161.2871 L233,171.2871 L23,171.2871 L23,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2494.8867" style="stroke: #000000; stroke-width: 2.0;" width="3040.5" x="23" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="38" y="167.8555">Prepare Validation Failure</text><path d="M72,176.5977 L72,706.5977 L413,706.5977 L413,186.5977 L403,176.5977 L72,176.5977 " fill="#FFFF00" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,176.5977 L403,186.5977 L413,186.5977 L403,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="194.166">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="209.4766">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="224.7871">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="240.0977">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="255.4082">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="270.7188">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="286.0293">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="301.3398">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="316.6504">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="331.9609">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="347.2715">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="362.582">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="377.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="78" y="393.2031">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="408.5137">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="94" y="423.8242">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="94" y="439.1348">"payeeFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="94" y="454.4453">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="94" y="469.7559">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="485.0664">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="110" y="500.377">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="515.6875">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="94" y="530.998">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="546.3086">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="561.6191">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="576.9297">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="592.2402">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="607.5508">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="142" y="622.8613">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="142" y="638.1719">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="653.4824">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="668.793">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="684.1035">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="699.4141">}</text><polygon fill="#A80036" points="328.5,733.4668,338.5,737.4668,328.5,741.4668,332.5,737.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="737.4668" y2="737.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="732.7246">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="732.7246">POST - http://transfers</text><path d="M355,750.4668 L355,1112.4668 L617,1112.4668 L617,760.4668 L607,750.4668 L355,750.4668 " fill="#FFFF00" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M607,750.4668 L607,760.4668 L617,760.4668 L607,750.4668 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="768.0352">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="783.3457">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="377" y="798.6563">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="377" y="813.9668">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="377" y="829.2773">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="844.5879">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="859.8984">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="393" y="875.209">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="393" y="890.5195">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="905.8301">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="921.1406">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="936.4512">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="951.7617">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="967.0723">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="982.3828">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="997.6934">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1013.0039">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="425" y="1028.3145">status: "success"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1043.625">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1058.9355">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1074.2461">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1089.5566">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1104.8672">}</text><polygon fill="#A80036" points="1201,1138.9199,1211,1142.9199,1201,1146.9199,1205,1142.9199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1207" y1="1142.9199" y2="1142.9199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1138.1777">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="370.5" y="1138.1777">Routes &amp; Publishes Prepare event for Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1213" x2="1255" y1="1172.2305" y2="1172.2305"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255" x2="1255" y1="1172.2305" y2="1185.2305"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1214" x2="1255" y1="1185.2305" y2="1185.2305"/><polygon fill="#A80036" points="1224,1181.2305,1214,1185.2305,1224,1189.2305,1220,1185.2305" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1220" y="1167.4883">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1233" y="1167.4883">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,1210.541,351.5,1214.541,361.5,1218.541,357.5,1214.541" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1212" y1="1214.541" y2="1214.541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1209.7988">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="1209.7988">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,1239.8516,68.5,1243.8516,78.5,1247.8516,74.5,1243.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="1243.8516" y2="1243.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1239.1094">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1239.1094">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1580,1269.1621,1590,1273.1621,1580,1277.1621,1584,1273.1621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1213" x2="1586" y1="1273.1621" y2="1273.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1220" y="1268.4199">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1233" y="1268.4199">Consumes Prepare event message for Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1302.4727" y2="1302.4727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1302.4727" y2="1315.4727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1315.4727" y2="1315.4727"/><polygon fill="#A80036" points="1613,1311.4727,1603,1315.4727,1613,1319.4727,1609,1315.4727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1297.7305">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="1622" y="1297.7305">Request to persist event information (refer to 1.1 for detail)</text><path d="M1508,1330.4727 L1727,1330.4727 L1727,1337.4727 L1717,1347.4727 L1508,1347.4727 L1508,1330.4727 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="271.1738" style="stroke: #000000; stroke-width: 2.0;" width="707" x="1508" y="1330.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="1523" y="1344.041">Validate Prepare Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1369.0938" y2="1369.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1369.0938" y2="1382.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1382.0938" y2="1382.0938"/><polygon fill="#A80036" points="1613,1378.0938,1603,1382.0938,1613,1386.0938,1609,1382.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1364.3516">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1622" y="1364.3516">Validates from - Payer (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1411.4043" y2="1411.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1411.4043" y2="1424.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1424.4043" y2="1424.4043"/><polygon fill="#A80036" points="1613,1420.4043,1603,1424.4043,1613,1428.4043,1609,1424.4043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1406.6621">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1622" y="1406.6621">Validates to - Payee (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1453.7148" y2="1453.7148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1453.7148" y2="1466.7148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1466.7148" y2="1466.7148"/><polygon fill="#A80036" points="1613,1462.7148,1603,1466.7148,1613,1470.7148,1609,1466.7148" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1448.9727">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="1631" y="1448.9727">Validates duplicate Check (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1496.0254" y2="1496.0254"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1496.0254" y2="1509.0254"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1509.0254" y2="1509.0254"/><polygon fill="#A80036" points="1613,1505.0254,1603,1509.0254,1613,1513.0254,1609,1509.0254" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1491.2832">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="1631" y="1491.2832">Validates amount (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1538.3359" y2="1538.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1538.3359" y2="1551.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1551.3359" y2="1551.3359"/><polygon fill="#A80036" points="1613,1547.3359,1603,1551.3359,1613,1555.3359,1609,1551.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1533.5938">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="1631" y="1533.5938">Validates crypto-condition (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1580.6465" y2="1580.6465"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1580.6465" y2="1593.6465"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1593.6465" y2="1593.6465"/><polygon fill="#A80036" points="1613,1589.6465,1603,1593.6465,1613,1597.6465,1609,1593.6465" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1575.9043">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="572" x="1631" y="1575.9043">Validates message signature (to be confirmed in future requirement) (refer to 1.1 for detail)</text><path d="M1508,1615.6465 L2042,1615.6465 L2042,1622.6465 L2032,1632.6465 L1508,1632.6465 L1508,1615.6465 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1545.5" x="1508" y="1615.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="489" x="1523" y="1629.2148">Persist Transfer State with transferState='ABORTED' on validation failure</text><polygon fill="#A80036" points="2980.5,1650.2676,2990.5,1654.2676,2980.5,1658.2676,2984.5,1654.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="2986.5" y1="1654.2676" y2="1654.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1649.5254">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1631" y="1649.5254">Request to persist transfer</text><polygon fill="#A80036" points="2862.5,1679.5781,2852.5,1683.5781,2862.5,1687.5781,2858.5,1683.5781" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2980.5,1679.5781,2990.5,1683.5781,2980.5,1687.5781,2984.5,1683.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2856.5" x2="2986.5" y1="1683.5781" y2="1683.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2868.5" y="1678.8359">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="2890.5" y="1678.8359">Persist transfer</text><polygon fill="#A80036" points="1613,1708.8887,1603,1712.8887,1613,1716.8887,1609,1712.8887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1607" x2="2991.5" y1="1712.8887" y2="1712.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1619" y="1708.1465">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1641" y="1708.1465">return success</text><path d="M1607,1732.8887 L1607,1757.8887 L1739,1757.8887 L1739,1742.8887 L1729,1732.8887 L1607,1732.8887 " fill="#FF0000" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1729,1732.8887 L1729,1742.8887 L1739,1742.8887 L1729,1732.8887 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1613" y="1750.457">Validation failure!</text><path d="M1607,1772.1992 L1607,2302.1992 L2214,2302.1992 L2214,1782.1992 L2204,1772.1992 L1607,1772.1992 " fill="#FFFF00" filter="url(#f1dfsqbkfkhv4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2204,1772.1992 L2204,1782.1992 L2214,1782.1992 L2204,1772.1992 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1613" y="1789.7676">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1613" y="1805.0781">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1629" y="1820.3887">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="1629" y="1835.6992">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1629" y="1851.0098">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1629" y="1866.3203">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1629" y="1881.6309">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1645" y="1896.9414">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1645" y="1912.252">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1661" y="1927.5625">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="1677" y="1942.873">"errorCode": &lt;possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="1677" y="1958.1836">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="1677" y="1973.4941">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1645" y="1988.8047">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1629" y="2004.1152">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1629" y="2019.4258">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1645" y="2034.7363">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1661" y="2050.0469">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1661" y="2065.3574">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1661" y="2080.668">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1661" y="2095.9785">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1661" y="2111.2891">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="1661" y="2126.5996">status: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1677" y="2141.9102">type: functional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1677" y="2157.2207">code: failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1661" y="2172.5313">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1661" y="2187.8418">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1677" y="2203.1523">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="1677" y="2218.4629">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="1677" y="2233.7734">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1661" y="2249.084">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1645" y="2264.3945">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1629" y="2279.7051">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1613" y="2295.0156">}</text><polygon fill="#A80036" points="2203,2329.0684,2213,2333.0684,2203,2337.0684,2207,2333.0684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="2209" y1="2333.0684" y2="2333.0684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="2328.3262">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1631" y="2328.3262">Publishes Notification (failure) event for Payer</text><polygon fill="#A80036" points="2341.5,2358.3789,2351.5,2362.3789,2341.5,2366.3789,2345.5,2362.3789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1597" x2="2347.5" y1="2362.3789" y2="2362.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1604" y="2357.6367">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="1626" y="2357.6367">Publishes Notification (failure) event for Payer (handled by seperate process)</text><path d="M33,2377.3789 L256,2377.3789 L256,2384.3789 L246,2394.3789 L33,2394.3789 L33,2377.3789 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="264.7949" style="stroke: #000000; stroke-width: 2.0;" width="2876.5" x="33" y="2377.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="48" y="2390.9473">Send notification for Payer</text><polygon fill="#A80036" points="543,2412,533,2416,543,2420,539,2416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="2214" y1="2416" y2="2416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2411.2578">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="2411.2578">Consumes Notifications event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="574" y1="2445.3105" y2="2445.3105"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="574" x2="574" y1="2445.3105" y2="2458.3105"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="574" y1="2458.3105" y2="2458.3105"/><polygon fill="#A80036" points="543,2454.3105,533,2458.3105,543,2462.3105,539,2458.3105" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2440.5684">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="561" y="2440.5684">Request to persist event information (refer to 1.1 for detail)</text><polygon fill="#A80036" points="1040,2483.6211,1050,2487.6211,1040,2491.6211,1044,2487.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1046" y1="2487.6211" y2="2487.6211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2482.8789">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="561" y="2482.8789">Requests Notification details for Payer - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="2554.5,2512.9316,2564.5,2516.9316,2554.5,2520.9316,2558.5,2516.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052" x2="2560.5" y1="2516.9316" y2="2516.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1059" y="2512.1895">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1081" y="2512.1895">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="2577.5,2542.2422,2567.5,2546.2422,2577.5,2550.2422,2573.5,2546.2422" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2839.5,2542.2422,2849.5,2546.2422,2839.5,2550.2422,2843.5,2546.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2571.5" x2="2845.5" y1="2546.2422" y2="2546.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2583.5" y="2541.5">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="2605.5" y="2541.5">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="1063,2571.5527,1053,2575.5527,1063,2579.5527,1059,2575.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1057" x2="2565.5" y1="2575.5527" y2="2575.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1069" y="2570.8105">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1091" y="2570.8105">Returns Notifications details for Payer</text><polygon fill="#A80036" points="543,2600.8633,533,2604.8633,543,2608.8633,539,2604.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1051" y1="2604.8633" y2="2604.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2600.1211">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="571" y="2600.1211">Returns Notifications details for Payer</text><polygon fill="#A80036" points="78.5,2630.1738,68.5,2634.1738,78.5,2638.1738,74.5,2634.1738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="2634.1738" y2="2634.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2629.4316">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="106.5" y="2629.4316">HTTP Callback with Prepare result to Payer</text><!--
@startuml
title 1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber


actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Errors-Topic" as ERRORS_NOTIFICATIONS
entity "Event DAO" as EVENT_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant ERRORS_NOTIFICATIONS
    participant EVENT_DAO
    participant NOTIFY_DAO
    participant DB
end box

group Prepare Validation Failure
    activate MLAPI
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp1,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success"
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for Payer
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI

    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for Payer
    PREP_HANDLER <-> PREP_HANDLER: Request to persist event information (refer to 1.1 for detail)
    group Validate Prepare Transfer
        PREP_HANDLER <-> PREP_HANDLER: Validates from - Payer (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates to - Payee (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates amount (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement) (refer to 1.1 for detail)
    end

    group Persist Transfer State with transferState='ABORTED' on validation failure
        PREP_HANDLER -> TRANS_DAO: Request to persist transfer
        TRANS_DAO <-> DB: Persist transfer
        TRANS_DAO -> PREP_HANDLER: return success
    end

    note right of PREP_HANDLER #red: Validation failure!
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <ledgerName>,
            to: <transferMessage.payerFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: {
                    "errorInformation": {
                        "errorCode": <possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]>
                        "errorDescription": "<refer to section 35.1.3 for description>",
                        "extensionList": <transferMessage.extensionList>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>,
                    status: {
                        type: functional
                        code: failure
                    }
                    state: {
                        status: 'error',
                        code: <errorInformation.errorCode>
                        description: <errorInformation.errorDescription>
                    }
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for Payer
    PREP_HANDLER -> ERRORS_NOTIFICATIONS: Publishes Notification (failure) event for Payer (handled by seperate process)
    deactivate PREP_HANDLER

    group Send notification for Payer
        activate NOTIFY_HANDLER
        TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
        NOTIFY_HANDLER <-> NOTIFY_HANDLER: Request to persist event information (refer to 1.1 for detail)
        NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payer - GET - HTTP://notifications/DFPS1
        CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payer
        NOTIFY_DAO <-> DB: Fetches Notifications details for Payer
        NOTIFY_DAO -> CSAPI: Returns Notifications details for Payer
        CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payer
        NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payer
        deactivate NOTIFY_HANDLER
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>