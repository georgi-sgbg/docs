<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1476px" preserveAspectRatio="none" style="width:894px;height:1476px;" version="1.1" viewBox="0 0 894 1476" width="894px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xq0yrercax9z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="330.5" y="23.5352">2.3.1. Timeout Handler Consume</text><rect fill="#FFFFE0" height="1431.4961" style="stroke: #A80036; stroke-width: 1.0;" width="811" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="384" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="1265.209" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="353.5" y="1338.4961"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613" y="317.7715"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="783" y="347.082"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="1250.209" style="stroke: #000000; stroke-width: 2.0;" width="870" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="545.5" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="850" x="23" y="263.8398"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="900.1719" style="stroke: #000000; stroke-width: 2.0;" width="430.5" x="23" y="476.3242"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="784.5508" style="stroke: #000000; stroke-width: 2.0;" width="258" x="124" y="525.6348"/><rect fill="#FFFFFF" height="391.0977" style="stroke: none; stroke-width: 1.0;" width="258" x="124" y="919.0879"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="124" x2="124" y1="116.2871" y2="1400.4961"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="358.5" x2="358.5" y1="116.2871" y2="1400.4961"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="505.5" x2="505.5" y1="116.2871" y2="1400.4961"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="617.5" x2="617.5" y1="116.2871" y2="1400.4961"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="788" x2="788" y1="116.2871" y2="1400.4961"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="33" y="113.334">Transfer Timeout Handler</text><ellipse cx="124.5" cy="83.7988" fill="#FEFECE" filter="url(#f1xq0yrercax9z)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="120.5,71.7988,126.5,66.7988,124.5,71.7988,126.5,76.7988,120.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="33" y="1413.0313">Transfer Timeout Handler</text><ellipse cx="124.5" cy="1431.9844" fill="#FEFECE" filter="url(#f1xq0yrercax9z)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="120.5,1419.9844,126.5,1414.9844,124.5,1419.9844,126.5,1424.9844,120.5,1419.9844" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="277.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="273.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="280.5" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="277.5" y="1399.4961"/><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="273.5" y="1403.4961"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="280.5" y="1424.0313">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="457.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="453.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="460.5" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="457.5" y="1399.4961"/><rect fill="#FEFECE" filter="url(#f1xq0yrercax9z)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="453.5" y="1403.4961"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="460.5" y="1424.0313">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="568.5" y="113.334">Transfer DAO</text><ellipse cx="618" cy="83.7988" fill="#FEFECE" filter="url(#f1xq0yrercax9z)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="606" x2="630" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="568.5" y="1413.0313">Transfer DAO</text><ellipse cx="618" cy="1431.9844" fill="#FEFECE" filter="url(#f1xq0yrercax9z)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="606" x2="630" y1="1445.9844" y2="1445.9844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="740" y="113.334">Central Store</text><path d="M770,63.7988 C770,53.7988 788,53.7988 788,53.7988 C788,53.7988 806,53.7988 806,63.7988 L806,89.7988 C806,99.7988 788,99.7988 788,99.7988 C788,99.7988 770,99.7988 770,89.7988 L770,63.7988 " fill="#FEFECE" filter="url(#f1xq0yrercax9z)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M770,63.7988 C770,73.7988 788,73.7988 788,73.7988 C788,73.7988 806,73.7988 806,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="740" y="1413.0313">Central Store</text><path d="M770,1425.9844 C770,1415.9844 788,1415.9844 788,1415.9844 C788,1415.9844 806,1415.9844 806,1425.9844 L806,1451.9844 C806,1461.9844 788,1461.9844 788,1461.9844 C788,1461.9844 770,1461.9844 770,1451.9844 L770,1425.9844 " fill="#FEFECE" filter="url(#f1xq0yrercax9z)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M770,1425.9844 C770,1435.9844 788,1435.9844 788,1435.9844 C788,1435.9844 806,1435.9844 806,1425.9844 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="1265.209" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="353.5" y="1338.4961"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613" y="317.7715"/><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="783" y="347.082"/><path d="M13,133.2871 L239,133.2871 L239,140.2871 L229,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1250.209" style="stroke: #000000; stroke-width: 2.0;" width="870" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="28" y="146.8555">Timeout Handler Consume</text><path d="M23,157.5977 L238,157.5977 L238,164.5977 L228,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="545.5" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="38" y="171.166">Persist Event Information</text><polygon fill="#A80036" points="494,192.2188,504,196.2188,494,200.2188,498,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="129.5" x2="500" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="136.5" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="149.5" y="191.4766">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1xq0yrercax9z)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="527.5" x="30" y="204.2188"/><polygon fill="#EEEEEE" points="30,204.2188,94,204.2188,94,211.2188,84,221.2188,30,221.2188,30,204.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="43" y="218.7871">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="196.75" y="237.7871">Event Handler Consume {9.1.0.}</text><path d="M23,263.8398 L244,263.8398 L244,270.8398 L234,280.8398 L23,280.8398 L23,263.8398 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="850" x="23" y="263.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="38" y="277.4082">Request expired transfers</text><polygon fill="#A80036" points="601,313.7715,611,317.7715,601,321.7715,605,317.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="129.5" x2="607" y1="317.7715" y2="317.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="136.5" y="305.374">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="149.5" y="297.7188">Request all expired transfers (Date.now() &gt; expirationDate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="149.5" y="313.0293">with transferState IN ['RECEIVED', 'RESERVED']</text><polygon fill="#A80036" points="771,343.082,781,347.082,771,351.082,775,347.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623" x2="777" y1="347.082" y2="347.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="630" y="342.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="643" y="342.3398">Fetch from database</text><polygon fill="#A80036" points="634,372.3926,624,376.3926,634,380.3926,630,376.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="628" x2="787" y1="376.3926" y2="376.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="640" y="371.6504">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="657" y="371.6504"/><polygon fill="#FFFFE0" filter="url(#f1xq0yrercax9z)" points="722,389.3926,853,389.3926,863,408.3926,853,427.3926,722,427.3926,712,408.3926,722,389.3926" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="724" y="405.9609">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="724" y="421.2715">transferStateChange</text><polygon fill="#A80036" points="140.5,450.3242,130.5,454.3242,140.5,458.3242,136.5,454.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="134.5" x2="617" y1="454.3242" y2="454.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146.5" y="449.582">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="159.5" y="449.582">Return list of all transfers to be aborted</text><path d="M23,476.3242 L97,476.3242 L97,483.3242 L87,493.3242 L23,493.3242 L23,476.3242 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="900.1719" style="stroke: #000000; stroke-width: 2.0;" width="430.5" x="23" y="476.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="38" y="489.8926">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="112" y="488.959">[for each transfer in the list]</text><path d="M124,525.6348 L186,525.6348 L186,532.6348 L176,542.6348 L124,542.6348 L124,525.6348 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="784.5508" style="stroke: #000000; stroke-width: 2.0;" width="258" x="124" y="525.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="139" y="539.2031">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="201" y="538.2695">[transferState == 'RECEIVED']</text><path d="M134,547.9453 L134,909.9453 L368,909.9453 L368,557.9453 L358,547.9453 L134,547.9453 " fill="#FFFF00" filter="url(#f1xq0yrercax9z)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M358,547.9453 L358,557.9453 L368,557.9453 L358,547.9453 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="140" y="565.5137">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="140" y="580.8242">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="156" y="596.1348">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="156" y="611.4453">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="156" y="626.7559">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="156" y="642.0664">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="156" y="657.377"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="156" y="657.377">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="172" y="672.6875"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="172" y="672.6875">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="172" y="687.998"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="172" y="687.998">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="156" y="703.3086"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="156" y="703.3086">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="156" y="718.6191">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="172" y="733.9297">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="188" y="749.2402">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="188" y="764.5508">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="188" y="779.8613">action: timeout-received,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="188" y="795.1719">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="188" y="810.4824">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="204" y="825.793">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="204" y="841.1035">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="188" y="856.4141">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="172" y="871.7246">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="156" y="887.0352">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="140" y="902.3457">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="124" x2="382" y1="920.0879" y2="920.0879"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="129" y="930.7227">[transferState == 'RESERVED']</text><path d="M134,939.043 L134,1301.043 L368,1301.043 L368,949.043 L358,939.043 L134,939.043 " fill="#FFFF00" filter="url(#f1xq0yrercax9z)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M358,939.043 L358,949.043 L368,949.043 L358,939.043 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="140" y="956.6113">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="140" y="971.9219">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="156" y="987.2324">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="156" y="1002.543">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="156" y="1017.8535">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="156" y="1033.1641">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="156" y="1048.4746"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="156" y="1048.4746">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="172" y="1063.7852"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="172" y="1063.7852">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="172" y="1079.0957"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="172" y="1079.0957">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="156" y="1094.4063"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="156" y="1094.4063">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="156" y="1109.7168">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="172" y="1125.0273">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="188" y="1140.3379">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="188" y="1155.6484">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="188" y="1170.959">action: timeout-reserved,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="188" y="1186.2695">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="188" y="1201.5801">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="204" y="1216.8906">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="204" y="1232.2012">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="188" y="1247.5117">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="172" y="1262.8223">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="156" y="1278.1328">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="140" y="1293.4434">}</text><polygon fill="#A80036" points="341.5,1334.4961,351.5,1338.4961,341.5,1342.4961,345.5,1338.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="129.5" x2="347.5" y1="1338.4961" y2="1338.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="136.5" y="1333.7539">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="149.5" y="1333.7539">Route &amp; Publish Position event</text><!--
@startuml
title 2.3.1. Timeout Handler Consume

autonumber


control "Transfer Timeout Handler" as EXP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Event-Topic" as TOPIC_EVENT
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant EXP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_EVENT
    participant TRANS_DAO
    participant DB
end box

activate EXP_HANDLER
group Timeout Handler Consume
    group Persist Event Information
        EXP_HANDLER -> TOPIC_EVENT: Publish event information
        ref over EXP_HANDLER, TOPIC_EVENT :  Event Handler Consume {9.1.0.} 
    end

    group Request expired transfers
        EXP_HANDLER -> TRANS_DAO: Request all expired transfers (Date.now() > expirationDate) \nwith transferState IN ['RECEIVED', 'RESERVED']
        activate TRANS_DAO
        TRANS_DAO -> DB: Fetch from database
        activate DB
        DB - -> TRANS_DAO
        deactivate DB
        hnote over DB #lightyellow
            transfer
            transferStateChange
        end note
        EXP_HANDLER <- - TRANS_DAO: Return list of all transfers to be aborted
        deactivate TRANS_DAO
    end

    loop for each transfer in the list
        |||
        alt transferState == 'RECEIVED'
            note right of EXP_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        <color #FF0000>payload: <transferMessage></color>
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            type: position,
                            action: timeout-received,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        else transferState == 'RESERVED'
            note right of EXP_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        <color #FF0000>payload: <transferMessage></color>
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            type: position,
                            action: timeout-reserved,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        end
        EXP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>