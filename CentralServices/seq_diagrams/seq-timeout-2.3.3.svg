<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1460px" preserveAspectRatio="none" style="width:1140px;height:1460px;" version="1.1" viewBox="0 0 1140 1460" width="1140px" zoomAndPan="magnify"><defs><filter height="300%" id="fgye6fswxic4y" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="311" x="415.75" y="23.5352">2.3.1. Transfer Handler Consume (Timeout)</text><rect fill="#FFFFE0" height="1415.1406" style="stroke: #A80036; stroke-width: 1.0;" width="1074.5" x="39" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="525.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="216" y="182.2188"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="1275.8535" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411" y="112.2871"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1031" y="1281.875"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="1261.8535" style="stroke: #000000; stroke-width: 2.0;" width="1116.5" x="13" y="119.2871"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="1230.543" style="stroke: #000000; stroke-width: 2.0;" width="1096.5" x="23" y="143.5977"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="90.9316" style="stroke: #000000; stroke-width: 2.0;" width="731.5" x="314.5" y="227.2188"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="711.5" x="324.5" y="251.5293"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="474.5" x="33" y="332.1504"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="815.1719" style="stroke: #000000; stroke-width: 2.0;" width="284" x="416" y="438.3926"/><rect fill="#FFFFFF" height="406.4082" style="stroke: none; stroke-width: 1.0;" width="284" x="416" y="847.1563"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1096.5" x="23" y="1319.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="95" x2="95" y1="102.2871" y2="1398.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="221" x2="221" y1="102.2871" y2="1398.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="415.5" x2="415.5" y1="102.2871" y2="1398.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1035.5" x2="1035.5" y1="102.2871" y2="1398.1406"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="47" y="62.7988"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="43" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="50" y="87.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="47" y="1397.1406"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="43" y="1401.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="50" y="1421.6758">Event-Topic</text><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="162" y="62.7988"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="158" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="165" y="87.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="162" y="1397.1406"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="158" y="1401.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="165" y="1421.6758">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="334.5" y="99.334">Transfer Event Handler</text><ellipse cx="416" cy="69.7988" fill="#FEFECE" filter="url(#fgye6fswxic4y)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="412,57.7988,418,52.7988,416,57.7988,418,62.7988,412,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="334.5" y="1410.6758">Transfer Event Handler</text><ellipse cx="416" cy="1429.6289" fill="#FEFECE" filter="url(#fgye6fswxic4y)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="412,1417.6289,418,1412.6289,416,1417.6289,418,1422.6289,412,1417.6289" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="966.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="962.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="969.5" y="87.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="966.5" y="1397.1406"/><rect fill="#FEFECE" filter="url(#fgye6fswxic4y)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="962.5" y="1401.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="969.5" y="1421.6758">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="216" y="182.2188"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="1275.8535" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411" y="112.2871"/><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1031" y="1281.875"/><path d="M13,119.2871 L311,119.2871 L311,126.2871 L301,136.2871 L13,136.2871 L13,119.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1261.8535" style="stroke: #000000; stroke-width: 2.0;" width="1116.5" x="13" y="119.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="28" y="132.8555">Transfer Handler Consume (Timeout)</text><path d="M23,143.5977 L85,143.5977 L85,150.5977 L75,160.5977 L23,160.5977 L23,143.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1230.543" style="stroke: #000000; stroke-width: 2.0;" width="1096.5" x="23" y="143.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="157.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="156.2324">[Consume Single Message]</text><polygon fill="#A80036" points="237,178.2188,227,182.2188,237,186.2188,233,182.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="410" y1="182.2188" y2="182.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="243" y="177.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="256" y="177.4766">Consume Transfer event</text><path d="M314.5,227.2188 L398.5,227.2188 L398.5,234.2188 L388.5,244.2188 L314.5,244.2188 L314.5,227.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.9316" style="stroke: #000000; stroke-width: 2.0;" width="731.5" x="314.5" y="227.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="329.5" y="240.7871">break</text><path d="M324.5,251.5293 L466.5,251.5293 L466.5,258.5293 L456.5,268.5293 L324.5,268.5293 L324.5,251.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="711.5" x="324.5" y="251.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="339.5" y="265.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="463" y1="290.1504" y2="290.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="463" x2="463" y1="290.1504" y2="303.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="422" x2="463" y1="303.1504" y2="303.1504"/><polygon fill="#A80036" points="432,299.1504,422,303.1504,432,307.1504,428,303.1504" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="428" y="285.4082">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="583" x="441" y="285.4082">Validate event - Rule: type == 'transfer' &amp;&amp; action IN ['timeout-received', 'timeout-reserved']</text><path d="M33,332.1504 L248,332.1504 L248,339.1504 L238,349.1504 L33,349.1504 L33,332.1504 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="474.5" x="33" y="332.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="48" y="345.7188">Persist Event Information</text><polygon fill="#A80036" points="106.5,366.7715,96.5,370.7715,106.5,374.7715,102.5,370.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="100.5" x2="410" y1="370.7715" y2="370.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="112.5" y="366.0293">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="125.5" y="366.0293">Publish event information</text><rect fill="#FFFFFF" filter="url(#fgye6fswxic4y)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="456.5" x="40" y="378.7715"/><polygon fill="#EEEEEE" points="40,378.7715,104,378.7715,104,385.7715,94,395.7715,40,395.7715,40,378.7715" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="393.3398">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="171.25" y="412.3398">Event Handler Consume {9.1.0.}</text><path d="M416,438.3926 L478,438.3926 L478,445.3926 L468,455.3926 L416,455.3926 L416,438.3926 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="815.1719" style="stroke: #000000; stroke-width: 2.0;" width="284" x="416" y="438.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="431" y="451.9609">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="171" x="493" y="451.0273">[action == 'timeout-received']</text><path d="M426,460.7031 L426,837.7031 L686,837.7031 L686,470.7031 L676,460.7031 L426,460.7031 " fill="#FFFF00" filter="url(#fgye6fswxic4y)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676,460.7031 L676,470.7031 L686,470.7031 L676,460.7031 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="432" y="478.2715">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="432" y="493.582">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="448" y="508.8926">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="448" y="524.2031">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="448" y="539.5137">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="448" y="554.8242">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="448" y="570.1348"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="448" y="570.1348">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="464" y="585.4453"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="464" y="585.4453">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="464" y="600.7559"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="464" y="600.7559">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="448" y="616.0664"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="448" y="616.0664">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="448" y="631.377">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="464" y="646.6875">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="480" y="661.998">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="480" y="677.3086">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="480" y="692.6191">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="480" y="707.9297">action: timeout-received,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="480" y="723.2402">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="480" y="738.5508">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="496" y="753.8613">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="496" y="769.1719">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="480" y="784.4824">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="464" y="799.793">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="448" y="815.1035">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="432" y="830.4141">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="416" x2="700" y1="848.1563" y2="848.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="421" y="858.791">[action == 'timeout-reserved']</text><path d="M426,867.1113 L426,1244.1113 L686,1244.1113 L686,877.1113 L676,867.1113 L426,867.1113 " fill="#FFFF00" filter="url(#fgye6fswxic4y)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676,867.1113 L676,877.1113 L686,877.1113 L676,867.1113 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="432" y="884.6797">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="432" y="899.9902">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="448" y="915.3008">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="448" y="930.6113">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="448" y="945.9219">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="448" y="961.2324">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="448" y="976.543"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="448" y="976.543">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="464" y="991.8535"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="464" y="991.8535">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="464" y="1007.1641"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="464" y="1007.1641">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="448" y="1022.4746"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="448" y="1022.4746">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="448" y="1037.7852">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="464" y="1053.0957">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="480" y="1068.4063">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="480" y="1083.7168">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="480" y="1099.0273">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="480" y="1114.3379">action: timeout-reserved,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="480" y="1129.6484">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="480" y="1144.959">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="496" y="1160.2695">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="496" y="1175.5801">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="480" y="1190.8906">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="464" y="1206.2012">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="448" y="1221.5117">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="432" y="1236.8223">}</text><polygon fill="#A80036" points="1019,1277.875,1029,1281.875,1019,1285.875,1023,1281.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="1025" y1="1281.875" y2="1281.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="428" y="1277.1328">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="441" y="1277.1328">Publish Notification event for successful timeout</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1119.5" y1="1320.875" y2="1320.875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="1331.5098">[Consume Batch Messages]</text><path d="M188,1339.8301 L188,1364.8301 L402,1364.8301 L402,1349.8301 L392,1339.8301 L188,1339.8301 " fill="#ADD8E6" filter="url(#fgye6fswxic4y)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M392,1339.8301 L392,1349.8301 L402,1349.8301 L392,1339.8301 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="194" y="1357.3984">To be delivered by future story</text><!--
@startuml
title 2.3.1. Transfer Handler Consume (Timeout)

autonumber


collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Event-Topic" as TOPIC_EVENT

box "Central Service" #LightYellow
    participant TOPIC_EVENT
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate TRANS_HANDLER
group Transfer Handler Consume (Timeout)
    alt Consume Single Message
        TOPIC_TRANSFERS <- TRANS_HANDLER: Consume Transfer event
        activate TOPIC_TRANSFERS
        deactivate TOPIC_TRANSFERS

        break
            group Validate Event
                TRANS_HANDLER <-> TRANS_HANDLER: Validate event - Rule: type == 'transfer' && action IN ['timeout-received', 'timeout-reserved']
            end
        end

        group Persist Event Information
            TRANS_HANDLER -> TOPIC_EVENT: Publish event information
	        ref over TRANS_HANDLER, TOPIC_EVENT :  Event Handler Consume {9.1.0.}
        end

        alt action == 'timeout-received'
            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        <color #FF0000>payload: <transferMessage></color>
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: timeout-received,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        else action == 'timeout-reserved'
            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        <color #FF0000>payload: <transferMessage></color>
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: timeout-reserved,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        end

        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for successful timeout
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS


    else Consume Batch Messages
        note left of TRANS_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate TRANS_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>