<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3061px" preserveAspectRatio="none" style="width:1262px;height:3061px;" version="1.1" viewBox="0 0 1262 3061" width="1262px" zoomAndPan="magnify"><defs><filter height="300%" id="fwft3hadeoezi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="326" x="469" y="23.5352">6.2.6. Settlement Abort (abortSettlementById)</text><rect fill="#FFB6C1" height="3016.0859" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="51" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="66.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="3016.0859" style="stroke: #A80036; stroke-width: 1.0;" width="360.5" x="294.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="412.75" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="3016.0859" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="901" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="904" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2806.7988" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2653.9355" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="278.1504"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2268.6563" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="322.7715"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="352.082"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="893"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1255.2793"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1515.627"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1754.3535"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1888.5957"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2104.0801"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2238.3223"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2362.2539"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2484.8066"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2792.7988" style="stroke: #000000; stroke-width: 2.0;" width="1238" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="696.4023" style="stroke: #000000; stroke-width: 2.0;" width="714" x="527" y="506.2559"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="594" y="554.4316"/><rect fill="#FFFFFF" height="162.1289" style="stroke: none; stroke-width: 1.0;" width="714" x="527" y="694.6055"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="307" x="594" y="716.5605"/><rect fill="#FFFFFF" height="345.9238" style="stroke: none; stroke-width: 1.0;" width="714" x="527" y="856.7344"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="594" y="1062.4844"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="1346.459" style="stroke: #000000; stroke-width: 2.0;" width="682" x="517" y="1216.6582"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="656" x="527" y="1715.7324"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="615" x="527" y="2065.459"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="609" x="527" y="2323.6328"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="333.6582" style="stroke: #000000; stroke-width: 2.0;" width="505" x="23" y="2606.4277"/><rect fill="#FFFFFF" height="186.4844" style="stroke: none; stroke-width: 1.0;" width="505" x="23" y="2753.6016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="107" x2="107" y1="137.2871" y2="2964.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="376.5" x2="376.5" y1="137.2871" y2="2964.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="594" x2="594" y1="137.2871" y2="2964.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="958" x2="958" y1="137.2871" y2="2964.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="55" y="134.334">Hub Employee</text><ellipse cx="107" cy="63.7988" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M107,71.7988 L107,98.7988 M94,79.7988 L120,79.7988 M107,98.7988 L94,113.7988 M107,98.7988 L120,113.7988 " fill="none" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="55" y="2976.6211">Hub Employee</text><ellipse cx="107" cy="2989.5742" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M107,2997.5742 L107,3024.5742 M94,3005.5742 L120,3005.5742 M107,3024.5742 L94,3039.5742 M107,3024.5742 L120,3039.5742 " fill="none" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="298.5" y="134.334">Settlement Service API</text><path d="M356.5,92.7988 L356.5,116.7988 M356.5,104.7988 L373.5,104.7988 " fill="none" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="385.5" cy="104.7988" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="298.5" y="2976.6211">Settlement Service API</text><path d="M356.5,2983.5742 L356.5,3007.5742 M356.5,2995.5742 L373.5,2995.5742 " fill="none" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="385.5" cy="2995.5742" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="537" y="134.334">Settlement DAO</text><ellipse cx="594" cy="104.7988" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="582" x2="606" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="537" y="2976.6211">Settlement DAO</text><ellipse cx="594" cy="2995.5742" fill="#FEFECE" filter="url(#fwft3hadeoezi)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="582" x2="606" y1="3009.5742" y2="3009.5742"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="910" y="134.334">Central Store</text><path d="M940,84.7988 C940,74.7988 958,74.7988 958,74.7988 C958,74.7988 976,74.7988 976,84.7988 L976,110.7988 C976,120.7988 958,120.7988 958,120.7988 C958,120.7988 940,120.7988 940,110.7988 L940,84.7988 " fill="#FEFECE" filter="url(#fwft3hadeoezi)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M940,84.7988 C940,94.7988 958,94.7988 958,94.7988 C958,94.7988 976,94.7988 976,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="910" y="2976.6211">Central Store</text><path d="M940,2989.5742 C940,2979.5742 958,2979.5742 958,2979.5742 C958,2979.5742 976,2979.5742 976,2989.5742 L976,3015.5742 C976,3025.5742 958,3025.5742 958,3025.5742 C958,3025.5742 940,3025.5742 940,3015.5742 L940,2989.5742 " fill="#FEFECE" filter="url(#fwft3hadeoezi)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M940,2989.5742 C940,2999.5742 958,2999.5742 958,2999.5742 C958,2999.5742 976,2999.5742 976,2989.5742 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2806.7988" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2653.9355" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="278.1504"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="2268.6563" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="322.7715"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="352.082"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="893"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1255.2793"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1515.627"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1754.3535"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="1888.5957"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2104.0801"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2238.3223"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2362.2539"/><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="953" y="2484.8066"/><path d="M13,154.2871 L172,154.2871 L172,161.2871 L162,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2792.7988" style="stroke: #000000; stroke-width: 2.0;" width="1238" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="28" y="167.8555">Settlement Abort</text><path d="M117,176.5977 L117,247.5977 L337,247.5977 L337,186.5977 L327,176.5977 L117,176.5977 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M327,176.5977 L327,186.5977 L337,186.5977 L327,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="123" y="194.166">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="139" y="209.4766">"state": "NOT_SETTLED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="139" y="224.7871">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="123" y="240.0977">}</text><polygon fill="#A80036" points="360,274.1504,370,278.1504,360,282.1504,364,278.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="112" x2="366" y1="278.1504" y2="278.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="119" y="273.4082">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="132" y="273.4082">PUT - /settlement/{id}/abort</text><polygon fill="#A80036" points="577,318.7715,587,322.7715,577,326.7715,581,322.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="583" y1="322.7715" y2="322.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="310.374">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="402" y="302.7188">abortSettlementById routine</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="402" y="318.0293">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="479" y="318.0293">2001</text><polygon fill="#A80036" points="941,348.082,951,352.082,941,356.082,945,352.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="352.082" y2="352.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="606" y="347.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="619" y="347.3398">Retrieve settlement information</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="771,365.082,1145,365.082,1155,414.082,1145,464.082,771,464.082,761,414.082,771,365.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="773" y="381.6504">SELECT s.settlementId, ssc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="789" y="396.9609">ssc.reason, ssc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="773" y="412.2715">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="813" y="412.2715">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="889" y="412.2715">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="773" y="427.582">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="805" y="427.582">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="966" y="427.582">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="773" y="442.8926">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="773" y="458.2031">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="610,487.2559,600,491.2559,610,495.2559,606,491.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="491.2559" y2="491.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="616" y="486.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="629" y="486.5137">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="674" y="486.5137">settlementData</text><path d="M527,506.2559 L589,506.2559 L589,513.2559 L579,523.2559 L527,523.2559 L527,506.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="696.4023" style="stroke: #000000; stroke-width: 2.0;" width="714" x="527" y="506.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="542" y="519.8242">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="388" x="604" y="518.8906">[settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="604" y="531.8457">settlementData.settlementStateId == 'SETTLING'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="604" y="544.8008">settlementData.settlementStateId == 'SETTLED']</text><path d="M594,554.4316 L678,554.4316 L678,561.4316 L668,571.4316 L594,571.4316 L594,554.4316 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="594" y="554.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="609" y="568">break</text><path d="M604,576.7422 L604,677.7422 L960,677.7422 L960,586.7422 L950,576.7422 L604,576.7422 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M950,576.7422 L950,586.7422 L960,586.7422 L950,576.7422 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="594.3105">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="626" y="609.6211">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="642" y="624.9316">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="642" y="640.2422">"errorDescription": "State change is not allowed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="626" y="655.5527">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="670.8633">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="527" x2="1241" y1="695.6055" y2="695.6055"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303" x="532" y="706.2402">[settlementData.settlementStateId == 'NOT_SETTLED']</text><path d="M594,716.5605 L678,716.5605 L678,723.5605 L668,733.5605 L594,733.5605 L594,716.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="307" x="594" y="716.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="609" y="730.1289">break</text><path d="M604,738.8711 L604,839.8711 L887,839.8711 L887,748.8711 L877,738.8711 L604,738.8711 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M877,738.8711 L877,748.8711 L887,748.8711 L877,738.8711 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="756.4395">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="626" y="771.75">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="642" y="787.0605">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="642" y="802.3711">"errorDescription": "Already aborted"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="626" y="817.6816">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="832.9922">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="527" x2="1241" y1="857.7344" y2="857.7344"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="371" x="532" y="868.3691">[settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED']</text><polygon fill="#A80036" points="941,889,951,893,941,897,945,893" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="893" y2="893"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="606" y="888.2578">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="619" y="888.2578">Find account in PS_TRANSFERS_COMMITTED</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="694,906,1221,906,1231,963,1221,1021,694,1021,684,963,694,906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="696" y="922.5684">SELECT spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="696" y="937.8789">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="736" y="937.8789">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="947" y="937.8789">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="696" y="953.1895">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="728" y="953.1895">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1024" y="953.1895">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="696" y="968.5">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="696" y="983.8105">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="696" y="999.1211">AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="696" y="1014.4316">LIMIT 1</text><polygon fill="#A80036" points="610,1043.4844,600,1047.4844,610,1051.4844,606,1047.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="1047.4844" y2="1047.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="616" y="1042.7422">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="629" y="1042.7422">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="674" y="1042.7422">transferCommittedAccount</text><path d="M594,1062.4844 L678,1062.4844 L678,1069.4844 L668,1079.4844 L594,1079.4844 L594,1062.4844 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="594" y="1062.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="609" y="1076.0527">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="693" y="1075.1191">[transferCommittedAccount != undefined]</text><path d="M604,1084.7949 L604,1185.7949 L1074,1185.7949 L1074,1094.7949 L1064,1084.7949 L604,1084.7949 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1064,1084.7949 L1064,1094.7949 L1074,1094.7949 L1064,1084.7949 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="1102.3633">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="626" y="1117.6738">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="642" y="1132.9844">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="642" y="1148.2949">"errorDescription": "At least one settlement transfer is committed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="626" y="1163.6055">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="610" y="1178.916">}</text><path d="M517,1216.6582 L682,1216.6582 L682,1223.6582 L672,1233.6582 L517,1233.6582 L517,1216.6582 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1346.459" style="stroke: #000000; stroke-width: 2.0;" width="682" x="517" y="1216.6582"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="532" y="1230.2266">DB TRANSACTION</text><polygon fill="#A80036" points="941,1251.2793,951,1255.2793,941,1259.2793,945,1255.2793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="1255.2793" y2="1255.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="606" y="1250.5371">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="619" y="1250.5371">Retrive settlement accounts information</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="774,1268.2793,1142,1268.2793,1152,1363.2793,1142,1459.2793,774,1459.2793,764,1363.2793,774,1268.2793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="776" y="1284.8477">SELECT pc.participantId, spc.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="792" y="1300.1582">spcsc.settlementStateId, spcsc.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="792" y="1315.4688">spcsc.createdDate, spc.netAmount, pc.currencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="792" y="1330.7793">spc.settlementParticipantCurrencyId AS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1044" y="1330.7793">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="776" y="1346.0898">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="816" y="1346.0898">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1027" y="1346.0898">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="776" y="1361.4004">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="808" y="1361.4004">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1104" y="1361.4004">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="776" y="1376.7109">ON spcsc.settlementParticipantCurrencyStateChangeId =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="776" y="1392.0215">spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="776" y="1407.332">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="808" y="1407.332">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="948" y="1407.332">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="776" y="1422.6426">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="776" y="1437.9531">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="776" y="1453.2637">FOR UPDATE</text><polygon fill="#A80036" points="610,1482.3164,600,1486.3164,610,1490.3164,606,1486.3164" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="1486.3164" y2="1486.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="616" y="1481.5742">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="629" y="1481.5742">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="674" y="1481.5742">settlementAccountsList</text><polygon fill="#A80036" points="941,1511.627,951,1515.627,941,1519.627,945,1515.627" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="1515.627" y2="1515.627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="606" y="1510.8848">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="619" y="1510.8848">Retrive settlement windows information</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="736,1528.627,1179,1528.627,1189,1600.627,1179,1673.627,736,1673.627,726,1600.627,736,1528.627" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="738" y="1545.1953">SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="754" y="1560.5059">swsc.reason, swsc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="738" y="1575.8164">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="778" y="1575.8164">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="979" y="1575.8164">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="738" y="1591.127">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="770" y="1591.127">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="899" y="1591.127">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="738" y="1606.4375">ON sw.settlementWindow = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="738" y="1621.748">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="770" y="1621.748">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="984" y="1621.748">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="738" y="1637.0586">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="738" y="1652.3691">WHERE ssw.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="738" y="1667.6797">FOR UPDATE</text><polygon fill="#A80036" points="610,1696.7324,600,1700.7324,610,1704.7324,606,1700.7324" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="1700.7324" y2="1700.7324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="616" y="1695.9902">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="638" y="1695.9902">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="683" y="1695.9902">windowsList</text><path d="M527,1715.7324 L940,1715.7324 L940,1722.7324 L930,1732.7324 L527,1732.7324 L527,1715.7324 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="656" x="527" y="1715.7324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="368" x="542" y="1729.3008">Bulk insert settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="941,1750.3535,951,1754.3535,941,1758.3535,945,1754.3535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="1754.3535" y2="1754.3535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="1749.6113">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="628" y="1749.6113">Insert settlementParticipantCurrencyStateChange</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="822,1767.3535,1094,1767.3535,1104,1778.3535,1094,1790.3535,822,1790.3535,812,1778.3535,822,1767.3535" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="824" y="1783.9219">settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="610,1812.9746,600,1816.9746,610,1820.9746,606,1816.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="1816.9746" y2="1816.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="616" y="1812.2324">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="638" y="1812.2324">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="683" y="1812.2324">spcscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="641" y1="1846.2852" y2="1846.2852"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641" x2="641" y1="1846.2852" y2="1859.2852"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="600" x2="641" y1="1859.2852" y2="1859.2852"/><polygon fill="#A80036" points="610,1855.2852,600,1859.2852,610,1863.2852,606,1859.2852" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="1841.543">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="628" y="1841.543">Merge spcscIdList into settlementAccountsList</text><polygon fill="#A80036" points="941,1884.5957,951,1888.5957,941,1892.5957,945,1888.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="1888.5957" y2="1888.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="1883.8535">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="628" y="1883.8535">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="752,1931.5957,1163,1931.5957,1173,1942.5957,1163,1954.5957,752,1954.5957,742,1942.5957,752,1931.5957" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="754" y="1948.1641">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="808" y="1948.1641">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1015" y="1948.1641">.currentStateChangeIds</text><rect fill="#FFFFFF" filter="url(#fwft3hadeoezi)" height="86.5527" style="stroke: #000000; stroke-width: 2.0;" width="471" x="534" y="1966.9063"/><polygon fill="#EEEEEE" points="534,1966.9063,598,1966.9063,598,1973.9063,588,1983.9063,534,1983.9063,534,1966.9063" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="547" y="1981.4746">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="594" y="2000.4746">Settlement Transfer Abort {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/Diagrams/SequenceDiagrams/seq-settransfer-abort-6.3.4.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/Diagrams/SequenceDiagrams/seq-settransfer-abort-6.3.4.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="764" y="2000.4746">6.3.4</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="764" x2="796" y1="2002.4746" y2="2002.4746"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="796" y="2000.4746">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="598" y="2015.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="594" y="2031.0957">Inputs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="637" y="2031.0957">: settlementId, transactionTimestamp, enums, trx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="598" y="2046.4063"/><path d="M527,2065.459 L858,2065.459 L858,2072.459 L848,2082.459 L527,2082.459 L527,2065.459 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="615" x="527" y="2065.459"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="542" y="2079.0273">Bulk insert settlementWindowStateChange</text><polygon fill="#A80036" points="941,2100.0801,951,2104.0801,941,2108.0801,945,2104.0801" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="2104.0801" y2="2104.0801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="2099.3379">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="628" y="2099.3379">Insert settlementWindowStateChange</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="859,2117.0801,1057,2117.0801,1067,2128.0801,1057,2140.0801,859,2140.0801,849,2128.0801,859,2117.0801" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="861" y="2133.6484">settlementWindowStateChange</text><polygon fill="#A80036" points="610,2162.7012,600,2166.7012,610,2170.7012,606,2166.7012" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="2166.7012" y2="2166.7012"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="616" y="2161.959">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="638" y="2161.959">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="683" y="2161.959">swscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="641" y1="2196.0117" y2="2196.0117"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641" x2="641" y1="2196.0117" y2="2209.0117"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="600" x2="641" y1="2209.0117" y2="2209.0117"/><polygon fill="#A80036" points="610,2205.0117,600,2209.0117,610,2213.0117,606,2209.0117" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="2191.2695">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="628" y="2191.2695">Merge swscIdList into windowList</text><polygon fill="#A80036" points="941,2234.3223,951,2238.3223,941,2242.3223,945,2238.3223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="2238.3223" y2="2238.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="2233.5801">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="628" y="2233.5801">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="793,2281.3223,1122,2281.3223,1132,2292.3223,1122,2304.3223,793,2304.3223,783,2292.3223,793,2281.3223" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="795" y="2297.8906">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="849" y="2297.8906">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="974" y="2297.8906">.currentStateChangeIds</text><path d="M527,2323.6328 L772,2323.6328 L772,2330.6328 L762,2340.6328 L527,2340.6328 L527,2323.6328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="609" x="527" y="2323.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="542" y="2337.2012">Insert settlementStateChange</text><polygon fill="#A80036" points="941,2358.2539,951,2362.2539,941,2366.2539,945,2362.2539" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="2362.2539" y2="2362.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="2357.5117">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="628" y="2357.5117">Insert settlementStateChange</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="799,2375.2539,1116,2375.2539,1126,2401.2539,1116,2428.2539,799,2428.2539,789,2401.2539,799,2375.2539" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="801" y="2391.8223">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="885" y="2391.8223">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="817" y="2407.1328">(settlementId, settlementStateId, reason)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="801" y="2422.4434">VALUES ({id}, 'NOT_SETTLED', {abortReasonString})</text><polygon fill="#A80036" points="610,2451.4961,600,2455.4961,610,2459.4961,606,2455.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="604" x2="957" y1="2455.4961" y2="2455.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="616" y="2450.7539">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="638" y="2450.7539">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="683" y="2450.7539">settlementStateChangeId</text><polygon fill="#A80036" points="941,2480.8066,951,2484.8066,941,2488.8066,945,2484.8066" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="947" y1="2484.8066" y2="2484.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="606" y="2480.0645">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="628" y="2480.0645">Update pointer to current state change id</text><polygon fill="#FFFFE0" filter="url(#fwft3hadeoezi)" points="823,2527.8066,1092,2527.8066,1102,2538.8066,1092,2550.8066,823,2550.8066,813,2538.8066,823,2527.8066" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="825" y="2544.375">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="879" y="2544.375">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="951" y="2544.375">.currentStateChangeId</text><polygon fill="#A80036" points="393,2587.4277,383,2591.4277,393,2595.4277,389,2591.4277" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="593" y1="2591.4277" y2="2591.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="2586.6855">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="421" y="2586.6855">Return transaction result</text><path d="M23,2606.4277 L85,2606.4277 L85,2613.4277 L75,2623.4277 L23,2623.4277 L23,2606.4277 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="333.6582" style="stroke: #000000; stroke-width: 2.0;" width="505" x="23" y="2606.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="2619.9961">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="100" y="2619.0625">[success]</text><path d="M110,2628.7383 L110,2714.7383 L363,2714.7383 L363,2638.7383 L353,2628.7383 L110,2628.7383 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M353,2628.7383 L353,2638.7383 L363,2638.7383 L353,2628.7383 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="116" y="2646.3066">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="132" y="2661.6172">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="132" y="2676.9277">"state": 'NOT_SETTLED',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="132" y="2692.2383">"createdDate": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="116" y="2707.5488">}</text><polygon fill="#A80036" points="123,2741.6016,113,2745.6016,123,2749.6016,119,2745.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="117" x2="371" y1="2745.6016" y2="2745.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="129" y="2740.8594">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="151" y="2740.8594">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="528" y1="2754.6016" y2="2754.6016"/><path d="M387,2760.6016 L387,2785.6016 L514,2785.6016 L514,2770.6016 L504,2760.6016 L387,2760.6016 " fill="#D3D3D3" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M504,2760.6016 L504,2770.6016 L514,2770.6016 L504,2760.6016 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="393" y="2778.1699">Log ERROR event</text><path d="M33,2799.9121 L33,2900.9121 L363,2900.9121 L363,2809.9121 L353,2799.9121 L33,2799.9121 " fill="#FFFF00" filter="url(#fwft3hadeoezi)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M353,2799.9121 L353,2809.9121 L363,2809.9121 L353,2799.9121 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="2817.4805">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="55" y="2832.791">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="71" y="2848.1016">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="71" y="2863.4121">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="55" y="2878.7227">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="2894.0332">}</text><polygon fill="#A80036" points="123,2928.0859,113,2932.0859,123,2936.0859,119,2932.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="117" x2="376" y1="2932.0859" y2="2932.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="129" y="2927.3438">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="151" y="2927.3438">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.6. Settlement Abort (abortSettlementById)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Settlement Abort
    activate OPERATOR
    note right of OPERATOR #yellow
        {
            "state": "NOT_SETTLED",
            "reason": {abortReasonString}
        }
    end note

    OPERATOR -> SSAPI: PUT - /settlement/{id}/abort
    activate SSAPI
    SSAPI -> SETTLE_DAO: abortSettlementById routine\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO

    SETTLE_DAO -> DB: Retrieve settlement information
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId,
            ssc.reason, ssc.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return **settlementData**
    deactivate DB

    alt settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||\nsettlementData.settlementStateId == 'SETTLING'||\nsettlementData.settlementStateId == 'SETTLED'
    break
        note right of SETTLE_DAO #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "State change is not allowed"
                }
            }
        end note
    end
    else settlementData.settlementStateId == 'NOT_SETTLED'
    break
        note right of SETTLE_DAO #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Already aborted"
                }
            }
        end note
    end
    else settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED'
        SETTLE_DAO -> DB: Find account in PS_TRANSFERS_COMMITTED
        activate DB
        hnote over DB #lightyellow
            SELECT spc.participantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
            WHERE spc.settlementId = {id}
            AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'
            LIMIT 1
        end hnote
        SETTLE_DAO <- - DB: Return **transferCommittedAccount**
        deactivate DB
        break transferCommittedAccount != undefined
            note right of SETTLE_DAO #yellow
                {
                    errorInformation: {
                        "errorCode": <integer>,
                        "errorDescription": "At least one settlement transfer is committed"
                    }
                }
            end note
        end
    end

    group <color #blue>DB TRANSACTION</color>
        SETTLE_DAO -> DB: Retrive settlement accounts information
        activate DB
        hnote over DB #lightyellow
            SELECT pc.participantId, spc.participantCurrencyId,
                spcsc.settlementStateId, spcsc.reason,
                spcsc.createdDate, spc.netAmount, pc.currencyId,
                spc.settlementParticipantCurrencyId AS <color #0000FF>key</color>
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId =
            spc.currentStateChangeId
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **settlementAccountsList**
        deactivate DB

        SETTLE_DAO -> DB: Retrive settlement windows information
        activate DB
        hnote over DB #lightyellow
            SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,
                swsc.reason, swsc.createdDate
            FROM **settlementSettlementWindow** ssw
            JOIN **settlementWindow** sw
            ON sw.settlementWindow = ssw.settlementWindowId
            JOIN **settlementWindowStateChange** swsc
            ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
            WHERE ssw.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **windowsList**
        deactivate DB

        group Bulk insert settlementParticipantCurrencyStateChange
            SETTLE_DAO -> DB: Insert settlementParticipantCurrencyStateChange
            activate DB
            hnote over DB #lightyellow
                settlementParticipantCurrencyStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **spcscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge spcscIdList into settlementAccountsList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementParticipantCurrency**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        ref over SETTLE_DAO, DB: Settlement Transfer Abort {[[https://github.com/mojaloop/docs/blob/develop/Diagrams/SequenceDiagrams/seq-settransfer-abort-6.3.4.svg 6.3.4]]}\n\n**Inputs**: settlementId, transactionTimestamp, enums, trx\n

        group Bulk insert settlementWindowStateChange
            SETTLE_DAO -> DB: Insert settlementWindowStateChange
            activate DB
            hnote over DB #lightyellow
                settlementWindowStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **swscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge swscIdList into windowList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementWindow**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        group Insert settlementStateChange
            SETTLE_DAO -> DB: Insert settlementStateChange
            activate DB
            hnote over DB #lightyellow
                INSERT INTO **settlementStateChange**
                    (settlementId, settlementStateId, reason)
                VALUES ({id}, 'NOT_SETTLED', {abortReasonString})
            end hnote
            SETTLE_DAO <- - DB: Return **settlementStateChangeId**
            deactivate DB

            SETTLE_DAO -> DB: Update pointer to current state change id
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlement**.currentStateChangeId
            end hnote
            deactivate DB
        end
    end
    SSAPI <- - SETTLE_DAO: Return transaction result
    deactivate SETTLE_DAO

    alt success
        note left of SSAPI #yellow
            {
                "id": {id},
                "state": 'NOT_SETTLED',
                "createdDate": {abortReasonString}
            }
        end note

        SSAPI - -> OPERATOR: Respond HTTP - 200 (OK)
      else
        note right of SSAPI #lightgray
            Log ERROR event
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
    end
end
deactivate OPERATOR
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>